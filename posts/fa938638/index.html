<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="In me the tiger sniffs the rose"><title>GPUSkinning | Lazybones Kill PLAN</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">GPUSkinning</h1><a id="logo" href="/.">Lazybones Kill PLAN</a><p class="description">In me the tiger sniffs the rose</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">GPUSkinning</h1><div class="post-meta">Sep 17, 2018<span> | </span><span class="category"><a href="/categories/教程/">教程</a></span></div><div class="post-content"><p>GPUSkinning 教程大纲(UNITY3D)<br>节一. 原理</p>
<ol>
<li>动画：理解骨骼动画的运作方式</li>
<li>模型：理解美术的制作流程</li>
<li>骨骼：理解骨骼动画以及背后的数学意义</li>
</ol>
<p>节二. 实践</p>
<ol>
<li>技术背景</li>
<li>使用GPUSkinning</li>
<li>工作原理(重点)</li>
<li>实际效果</li>
<li>其他可以同时进行的优化方案</li>
</ol>
<a id="more"></a>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><h2 id="动画：骨骼动画的运作方式"><a href="#动画：骨骼动画的运作方式" class="headerlink" title="动画：骨骼动画的运作方式"></a>动画：骨骼动画的运作方式</h2><p>让们从轻松一点的内容开始本篇教程吧。</p>
<p>　　在的游戏中，骨骼动画的基础是关键帧技术，们先重温一下关键帧技术。</p>
<p>比较有代表性的是<strong>帧动画</strong>：们将一段较长的动作分解成几个关键帧，然后基于此进行动画的制作。即使现在们使用的工具更新换代，制作动画的思路还是大致如此，拆分与过渡。所有的工具都是帮们自动完善其中的细节。</p>
<embed src="http://player.youku.com/player.php/sid/XMzgzMjMzNjg4NA==/v.swf" allowfullscreen="true" quality="high" width="480" height="400" align="middle" allowscriptaccess="always" type="application/x-shockwave-flash">

<p><strong>Skinned Mesh</strong>：中文一般称作骨骼蒙皮动画，正如其名，这种动画中包含骨骼（ Bone ）和蒙皮 (Skinned Mesh) 两个部分， Bone 的层次结构和关节动画类似， Mesh 则和关节动画不同：关节动画中是使用多个分散的 Mesh, 而 Skinned Mesh 中 Mesh 是一个整体，也就是说只有一个 Mesh, 实际上如果没有骨骼让 Mesh 运动变形， Mesh 就和静态模型一样了。 Skinned Mesh 技术的精华在于蒙皮，所谓的皮并不是模型的贴图（也许会有人这么想过吧），而是 Mesh 本身，蒙皮是指将 Mesh 中的顶点附着（绑定）在骨骼之上，而且每个顶点可以被多个骨骼所控制，这样在关节处的顶点由于同时受到父子骨骼的拉扯而改变位置就消除了裂缝。 Skinned Mesh 这个词从字面上理解似乎是有皮的模型，哦，如果贴图是皮，那么普通静态模型不也都有吗？所以觉得应该理解为具有蒙皮信息的 Mesh 或可当做皮肤用的 Mesh ，这个皮肤就是 Mesh 。而为了有皮肤功能， Mesh 还需要蒙皮信息，即 Skin 数据，没有 Skin 数据就是一个普通的静态 Mesh 了。Skin 数据决定顶点如何绑定到骨骼上。顶点的 Skin 数据包括顶点受哪些骨骼影响以及这些骨骼影响该顶点时的权重(weight) ，另外</p>
<p><strong>Bone</strong>:对于每块骨骼还需要骨骼偏移矩阵 (BoneOffsetMatrix) 用来将顶点从 Mesh 空间变换到骨骼空间。骨骼控制蒙皮运动，而骨骼本身的运动呢？当然是动画数据了。每个关键帧中包含时间和骨骼运动信息，运动信息可以用一个矩阵直接表示骨骼新的变换，也可用四元数表示骨骼的旋转，也可以随便自己定义什么只要能让骨骼动就行。除了使用编辑设定好的动画帧数据，也可以使用物理计算对骨骼进行实时控制。</p>
<p><strong>UNITY3D中的Skinned Mesh Renderer组件</strong>:UNITY3D在导入模型的时候自动会给模型附加<strong>蒙皮网格(Skinned Mesh Renderer)</strong>，使用Unity骨骼人物的主要优势是可以使骨骼受到物理影响，譬如使用角色布娃娃。如下图所示<strong>Skinned Mesh Renderer</strong>会自动关联其对应的骨骼。</p>
<p><img src="/uploads/WX20180918-155553.png" alt=""></p>
<h2 id="模型：理解美术的制作流程"><a href="#模型：理解美术的制作流程" class="headerlink" title="模型：理解美术的制作流程"></a>模型：理解美术的制作流程</h2><p>　们在本文中主要讨论在UNITY3D内的实现方式。在UNITY中常用T-Pose居多。 T-Pose方便们对应骨骼与蒙皮方便校验表现与骨骼位置不一致的地方。对于每个骨骼，美术在建模的时候就进行了绑定，对于们程序只需要进行动画的播放，一般在骨骼上有一些额外的挂点。这些挂点是模拟出来的额外的点，通常提供给们挂一些武器或其他装备物体的节点。在完成建模后，在进行骨骼绑定的时候，通常美术会选择模型的盆骨做为模型的根骨骼。那么基于根骨骼，可以递推出各个骨骼相对于根骨的父子关系。通过骨骼所在的空间，其原点们会选择两个脚之间的中点作为原点，这时候就会发现根骨骼并没有和原点重合，这时美术会构建一个Scene_Root做为额外的骨骼，其位置就为世界原点，而真正的根骨骼Bip01会作为Scene_Root的唯一子骨骼。</p>
<p><img src="/uploads/unitychan.png" alt=""></p>
<h2 id="骨骼：理解骨骼动画以及背后的数学意义"><a href="#骨骼：理解骨骼动画以及背后的数学意义" class="headerlink" title="骨骼：理解骨骼动画以及背后的数学意义"></a>骨骼：理解骨骼动画以及背后的数学意义</h2><p>首先要明确一个观念：<strong>骨骼决定了模型整体在世界坐标系中的位置和朝向。</strong><br>静态模型没有骨骼，们在世界坐标系中放置静态模型时，只要指定模型自身坐标系在世界坐标系中的位置和朝向。在骨骼动画中，不是把 Mesh 直接放到世界坐标系中， Mesh 只是作为 Skin 使用的，是依附于骨骼的，真正决定模型在世界坐标系中的位置和朝向的是骨骼。在渲染静态模型时，由于模型的顶点都是定义在模型坐标系中的，所以各顶点只要经过模型坐标系到世界坐标系的变换后就可进行渲染。而对于骨骼动画，们设置模型的位置和朝向，实际是在设置根骨骼的位置和朝向，然后根据骨骼层次结构中父子骨骼之间的变换关系计算出各个骨骼的位置和朝向，然后根据骨骼对 Mesh 中顶点的绑定计算出顶点在世界坐标系中的坐标，从而对顶点进行渲染。要记住，在骨骼动画中，骨骼才是模型主体， Mesh 不过是一层皮，一件衣服。</p>
<p><img src="/uploads/bonejoint.png" alt=""><br>骨骼只是一个形象的说法，实际上<strong>骨骼可理解为一个坐标空间，关节可理解为骨骼坐标空间的原点</strong>。关节的位置由它在父骨骼坐标空间中的位置描述。上图中有三块骨骼，分别是上臂，前臂和两个手指。 Clavicle( 锁骨 ) 是一个关节，它是上臂的原点，同样肘关节 (elbow joint) 是前臂的原点，腕关节 (wrist) 是手指骨骼的原点。关节既决定了骨骼空间的位置，又是骨骼空间的旋转和缩放中心。为什么用一个 4X4 矩阵就可以表达一个骨骼，因为 4X4 矩阵中含有的平移分量决定了关节的位置，旋转和缩放分量决定了骨骼空间的旋转和缩放。们来看前臂这个骨骼，其原点位置是位于上臂上某处的，对于上臂来说，它知道自己的坐标空间某处（即肘关节所在的位置）有一个子空间，那就是前臂，至于前臂里面是啥就不考虑了。当前臂绕肘关节旋转时，实际是前臂坐标空间在旋转，从而其中包含的子空间也在绕肘关节旋转，在这个例子中是 finger 骨骼。和实际生物骨骼不同的是，们这里的骨骼并没有实质的骨头，所以前臂旋转时，他自己没啥可转的，改变的只是坐标空间的朝向。你可以说上图的蓝线在转，但实际蓝线并不存在，蓝线只是画上去表示骨骼之间关系的，真正转的是骨骼空间，们能看到在转的是 wrist joint ，也就是两个 finger 骨骼的坐标空间，因为他们是子空间，会跟随父空间运动，就好比人跟着地球转一样。</p>
<p><strong>骨骼就是坐标空间，骨骼层次就是嵌套的坐标空间。</strong>关节只是描述骨骼的位置即骨骼自己的坐标空间原点在其父空间中的位置，绕关节旋转是指骨骼坐标空间（包括所有子空间）自身的旋转，如此理解足矣。但还有两个可能的疑问，一是骨骼的长度问题，由于骨骼是坐标空间，没有所谓的长度和宽度的限制，们看到的长度一方面是蒙皮后的结果，另一方面子骨骼的原点（也就是关节）的位置往往决定了视觉上父骨骼的长度，比如这里 upper arm 线段的长度实际是由elbow joint 的位置决定的。第二个问题，手指的那个端点是啥啊？实际上在们的例子中手指没有子骨骼，所以那个端点并不存在：）那是为了方便演示画上去的。实际问题中总有最下层的骨骼，他们不能决定其他骨骼了，他们的作用只剩下控制 Mesh 顶点。对了，那么手指的长度如何确定？们看到的长度应该是由手指部分的顶点和蒙皮决定的，也就是由 Mesh 中属于手指的那些点离腕关节的距离决定。</p>
<p>为什么要将骨骼组织成层次结构呢？答案是为了做动画方便，设想如果只有一块骨骼，那么让他动起来就太简单了，动画每一帧直接指定他的位置即可。如果是n块呢？通过组成一个层次结构，就可以通过父骨骼控制子骨骼的运动，牵一发而动全身，改变某骨骼时并不需要设置其下子骨骼的位置，子骨骼的位置会通过计算自动得到。上文已经说过，父子骨骼之间的关系可以理解为，<strong>子骨骼位于父骨骼的坐标系中</strong>。们知道物体在坐标系中可以做平移变换，以及自身的旋转和缩放变换。子骨骼在父骨骼的坐标系中也可以做这些变换来改变自己在其父骨骼坐标系中的位置和朝向等。那么如何表示呢？由于4X4矩阵可以同时表示上述三种变换，所以一般描述骨骼在其父骨骼坐标系中的变换时使用一个矩阵，<strong>也就是DirectX SkinnedMesh中的FrameTransformMatrix</strong>。实际上这不是唯一的方法，但应该是公认的方法，因为矩阵不光可以同时表示多种变换还可以方便的通过连乘进行变换的组合，这在层次结构中非常方便。</p>
<p><strong>Vertex blending公式</strong><br>现在让们用一个公式总结一下Vertex blending的整个过程(使用矩阵变换)<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Vworld = Vmesh * BoneOffsetMatrix1 * CombindMatrix1 * Weight1</div><div class="line">+ Vmesh* BoneOffsetMatrix2 * CombinedMatrix2 * Weight2</div><div class="line">+ …</div><div class="line">+ Vmesh * BoneOffsetMatrixN * CombindMatrixN * WeightN</div></pre></td></tr></table></figure></p>
<p>（这个公式使用的是行向量左乘矩阵）</p>
<p>由于BoneOffsetMatrix和Combined Matrix都是矩阵，可以先相乘这样就减少很多计算了。</p>
<h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><h2 id="技术背景"><a href="#技术背景" class="headerlink" title="技术背景"></a>技术背景</h2><p>UNITY3D默认的骨骼动画组件[SKinnedMeshRender]使用的是CPU蒙皮，屏幕内模型较多的时候会造成CPU负担过大，导致卡顿，手机发热等。新版本UNITY3D可以开启GPU Skinning，但其使用的 Transfrom feedback 会将大量顶点从GPU传到CPU再计算，以此来完成动画融合或IK等功能。因此需要高效的GPU蒙皮方案。</p>
<h2 id="使用GPUSkinning"><a href="#使用GPUSkinning" class="headerlink" title="使用GPUSkinning"></a>使用GPUSkinning</h2><ol>
<li>使用Unity Animation/Animator和SkinnedMeshRenderer制作角色prefab， 保证Animation/Animator组件子构件有SkinnedMeshRenderer（可以参考Example目录中的例子）</li>
<li>添加GPUSkinningSampler脚本到Animation/Animator绑定的GameObject上</li>
</ol>
<p><img src="/uploads/QQ20180919-151122@2x.png" alt=""></p>
<p>更详细的资料您可参考  <a href="http://gsdn.sdo.com/help/GRender/GpuSkinning/GpuSkinning.html" target="_blank" rel="external">GpuSkinning使用手册 – GSDN</a></p>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>当场景中有很多人物动画模型的时候会产生大量开销，这些开销除了 DrawCall 外，很大一部分来自于骨骼动画。Unity 内置提供了 GPU Skinning 的功能，但测试下来并没有对整体性能有任何提升，反而整体的开销增加了不少。有很多种方法来减小骨骼动画的开销，每一种方法都有其利弊，都不是万金油，这里介绍的方法同样如此。其实本质还是 GPU Skinning，由们自己来实现，但是和 Unity 内置的 GPU Skinning 有所区别。<br><img src="/uploads/QQ20180919-155831@2x.png" alt=""></p>
<p>从上图中可以看到，Unity 调用到了 Opengl ES 的 Transform Feedback 接口，这个接口至少要到 OpenGL ES 3.0 才有。</p>
<p>在开启 GPUSkinning 的时候，Unity 确实已经在 CPU 中进行了骨骼变换，而后将矩阵数组传递给 Shader，通过 Transform Feedback 后，将结果存储到 Buffer Object 中，这时 Buffer Object 中存储的顶点数据已经是蒙皮完成了，最后渲染模型的时候直接拿来用即可。下面这段 glsl 既是输出 Transform Feedback 的，也证明了这点。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#version 300 es</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> max_bone_count = <span class="number">32</span>;</div><div class="line"><span class="keyword">const</span> highp <span class="keyword">float</span> max_bone_count_inv = <span class="number">1.0</span> / <span class="keyword">float</span>(max_bone_count); </div><div class="line"><span class="keyword">const</span> highp <span class="keyword">float</span> half_texel = <span class="number">0.5</span> * max_bone_count_inv; </div><div class="line"><span class="keyword">in</span> vec3 in_vertex;</div><div class="line"><span class="keyword">in</span> vec3 in_normal;</div><div class="line"><span class="keyword">in</span> vec4 in_tangent;</div><div class="line"><span class="keyword">in</span> ivec2 in_boneIndices;</div><div class="line"><span class="keyword">in</span> vec2  in_boneWeights;</div><div class="line"><span class="keyword">out</span> vec3 out_pos;</div><div class="line"><span class="keyword">out</span> vec3 out_normal;</div><div class="line"><span class="keyword">out</span> vec4 out_tangent;</div><div class="line"></div><div class="line">uniform vec4 bones[max_bone_count*<span class="number">3</span>];</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_MATRIX(idx) mat4( bones[int(idx)*3 + 0], bones[int(idx)*3 + 1], bones[int(idx)*3 + 2], vec4(0.0, 0.0, 0.0, 1.0))</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span></div><div class="line">&#123;</div><div class="line">    vec4 inpos = vec4(in_vertex.xyz, <span class="number">1.0</span>);</div><div class="line">    mat4 localToWorldMatrix = GET_MATRIX(in_boneIndices.x) * in_boneWeights[<span class="number">0</span>];</div><div class="line">    <span class="keyword">if</span>(in_boneWeights[<span class="number">1</span>] &gt; <span class="number">0.0</span>)</div><div class="line">        localToWorldMatrix += GET_MATRIX(in_boneIndices.y) * in_boneWeights[<span class="number">1</span>] ;</div><div class="line">    out_pos = (inpos * localToWorldMatrix).xyz;</div><div class="line">    gl_Position = vec4(out_pos.xyz, <span class="number">1.0</span>);</div><div class="line">    out_normal = normalize( ( vec4(in_normal.xyz, <span class="number">0.0</span>) * localToWorldMatrix)).xyz;</div><div class="line">    out_tangent = vec4( normalize( ( vec4(in_tangent.xyz, <span class="number">0.0</span>) * localToWorldMatrix)).xyz, in_tangent.w);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这次们要动手实现的就是这个过程，但是不使用 Transform Feedback，因为要保证在 OpenGL ES 2.0 上也能良好运行，况且引擎也没有提供这么底层的接口。</p>
<p>大致的步骤是这样的：</p>
<p>将骨骼动画数据序列化到自定义的数据结构中。这么做是因为这样能完全摆脱 Animation 的束缚，并且可以做到 Optimize Game Objects（Unity 中一个功能，将骨骼的层级结构 GameObjects 完全去掉，减少开销），同时不丢失绑点。<br>在 CPU 中进行骨骼变换。<br>将骨骼变换的结果传递给 GPU，进行蒙皮。<br>很简单的三大步，对于传统的骨骼动画来说没有任何特殊的步骤，下面会对其中的每一步展开说明，并将其中的细节说清楚。</p>
<h3 id="提取骨骼动画数据"><a href="#提取骨骼动画数据" class="headerlink" title="提取骨骼动画数据"></a>提取骨骼动画数据</h3><p><img src="/uploads/QQ20180919-160038@2x.png" alt=""><br>目的就是将这些数据提取出来，存储到自定义的数据结构中。代码大致是这样的：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">EditorCurveBinding[] curvesBinding = AnimationUtility.GetCurveBindings(animClip);</div><div class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> curveBinding <span class="keyword">in</span> curvesBinding)</div><div class="line">&#123;</div><div class="line">    <span class="comment">// 旋转</span></div><div class="line">    AnimationCurve curveRX = AnimationUtility.GetEditorCurve(animClip, curveBinding.path, curveBinding.type, <span class="string">"m_LocalRotation.x"</span>);</div><div class="line">    AnimationCurve curveRY = AnimationUtility.GetEditorCurve(animClip, curveBinding.path, curveBinding.type, <span class="string">"m_LocalRotation.y"</span>);</div><div class="line">    AnimationCurve curveRZ = AnimationUtility.GetEditorCurve(animClip, curveBinding.path, curveBinding.type, <span class="string">"m_LocalRotation.z"</span>);</div><div class="line">    AnimationCurve curveRW = AnimationUtility.GetEditorCurve(animClip, curveBinding.path, curveBinding.type, <span class="string">"m_LocalRotation.w"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 位移</span></div><div class="line">    AnimationCurve curvePX = AnimationUtility.GetEditorCurve(animClip, curveBinding.path, curveBinding.type, <span class="string">"m_LocalPosition.x"</span>);</div><div class="line">    AnimationCurve curvePY = AnimationUtility.GetEditorCurve(animClip, curveBinding.path, curveBinding.type, <span class="string">"m_LocalPosition.y"</span>);</div><div class="line">    AnimationCurve curvePZ = AnimationUtility.GetEditorCurve(animClip, curveBinding.path, curveBinding.type, <span class="string">"m_LocalPosition.z"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 不考虑缩放，假定所有骨骼的缩放都是 1</span></div><div class="line"></div><div class="line">    <span class="keyword">float</span> curveRX_v = curveRX.Evaluate(second);</div><div class="line">    <span class="keyword">float</span> curveRY_v = curveRY.Evaluate(second);</div><div class="line">    <span class="keyword">float</span> curveRZ_v = curveRZ.Evaluate(second);</div><div class="line">    <span class="keyword">float</span> curveRW_v = curveRW.Evaluate(second);</div><div class="line"></div><div class="line">    <span class="keyword">float</span> curvePX_v = curvePX.Evaluate(second);</div><div class="line">    <span class="keyword">float</span> curvePY_v = curvePY.Evaluate(second);</div><div class="line">    <span class="keyword">float</span> curvePZ_v = curvePZ.Evaluate(second);</div><div class="line"></div><div class="line">    Vector3 translation = <span class="keyword">new</span> Vector3(curvePX_v, curvePY_v, curvePZ_v);</div><div class="line">    Quaternion rotation = <span class="keyword">new</span> Quaternion(curveRX_v, curveRY_v, curveRZ_v, curveRW_v);</div><div class="line">    NormalizeQuaternion(<span class="keyword">ref</span> rotation);</div><div class="line">    matrices.Add(</div><div class="line">        Matrix4x4.TRS(translation, rotation, Vector3.one)</div><div class="line">    );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中有两个注意点。第一，要清楚 AnimationCurve 中提取出来的旋转量是欧拉角还是四元数，这里一开始就弄错了，想当然认为是欧拉角，所以随后计算得到的结果也就错了。第二，用来旋转的四元数，必须是单位四元数（模是1），否则你会得到 Unity 的一个报错信息。</p>
<p>以上的代码中，将每一帧的数据以 30fps 的频率直接采样了出来，其实也可以不采样出来，而是等需要的时候再从 AnimationCurve 中采样，这样会更平滑但是运行时的计算量也更多了。</p>
<h3 id="骨骼变换"><a href="#骨骼变换" class="headerlink" title="骨骼变换"></a>骨骼变换</h3><p>骨骼变换是所有代码的核心部分了，看似挺复杂，其实想清楚后代码量是最少的:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// 更新 Walk 动作的所有骨骼变换</span></div><div class="line">    UpdateBoneAnimationMatrix(<span class="string">"Walk"</span>, second);</div><div class="line">    second += Time.deltaTime;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateBoneAnimationMatrix</span>(<span class="params"><span class="keyword">string</span> animName, <span class="keyword">float</span> time</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// boneAnimation 是我们自定义的数据结构</span></div><div class="line">    <span class="comment">// 其中存储了刚才从 AnimationCurve 中采样到的动画数据</span></div><div class="line">    GPUSkinning_BoneAnimation boneAnimation = GetBoneAnimation(animName);</div><div class="line">    <span class="keyword">int</span> frameIndex = (<span class="keyword">int</span>)(time * boneAnimation.fps) % (<span class="keyword">int</span>)(boneAnimation.length * boneAnimation.fps);</div><div class="line">    <span class="comment">// 获取当前播放的是哪一帧的动画数据</span></div><div class="line">    GPUSkinning_BoneAnimationFrame frame = boneAnimation.frames[frameIndex];</div><div class="line"></div><div class="line">    <span class="comment">// 刷新所有的骨架动画矩阵</span></div><div class="line">    UpdateBoneTransformMatrix(bones[rootBoneIndex], Matrix4x4.identity, frame);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateBoneTransformMatrix</span>(<span class="params">GPUSkinning_Bone bone, Matrix4x4 parentMatrix, GPUSkinning_BoneAnimationFrame frame</span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> index = BoneAnimationFrameIndexOf(frame, bone);</div><div class="line">    Matrix4x4 mat = parentMatrix * frame.matrices[index];</div><div class="line">    <span class="comment">// 当前骨骼</span></div><div class="line">    bone.animationMatrix = mat * bone.bindpose;</div><div class="line"></div><div class="line">    <span class="comment">// 继续递归子骨骼</span></div><div class="line">    GPUSkinning_Bone[] children = bone.children;</div><div class="line">    <span class="keyword">int</span> numChildren = children.Length;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numChildren; ++i)</div><div class="line">    &#123;</div><div class="line">        UpdateBoneTransformMatrix(children[i], mat, frame);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>简单来说骨骼变换就是一个矩阵乘法，比如 bone0（简写为b0） 是 bone1（简写为b1） 的父骨骼：<br><img src="/uploads/QQ20180919-160341@2x.png" alt=""></p>
<p>注意这里是矩阵左乘（从右往左读），trs 是 Matrix4x4.TRS，也就是从 AnmationCurve 采样到的数据。<br>Bindpose 的作用是将模型空间中的顶点坐标变换到骨骼空间中（是骨骼矩阵的逆矩阵），然后应用当前骨骼的变换，沿着层级关系一层层的变换下去。</p>
<h3 id="蒙皮"><a href="#蒙皮" class="headerlink" title="蒙皮"></a>蒙皮</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    UpdateBoneAnimationMatrix(<span class="string">"Walk"</span>, second);</div><div class="line">    Play();</div><div class="line">    second += Time.deltaTime;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> Matrix4x4[] matricesUniformBlock = <span class="literal">null</span>;</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Play</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> numBones = bones.Length;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numBones; ++i)</div><div class="line">    &#123;</div><div class="line">        matricesUniformBlock[i] = bones[i].animationMatrix;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 将骨骼变换的结果传递到 Shader 中</span></div><div class="line">    <span class="comment">// SetMatrixArray这是 Unity5.4 之后提供的新的 API</span></div><div class="line">    <span class="comment">// 以前是不能直接传一个数组的，只能一个个元素单独传，效率很低</span></div><div class="line">    <span class="comment">// 新的 API 减小了开销（看下图）</span></div><div class="line">    newMtrl.SetMatrixArray(shaderPropID_Matrices<span class="comment">/*_Matrices*/</span>, matricesUniformBlock);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/QQ20180919-160501@2x.png" alt=""><br>由于骨骼数量固定为 24，所以图中的 96 = 24 x 4</p>
<p>使用 SetMatrixArray 其实有点浪费了，因为对于一个 4x4 的矩阵（四个float4）来说，最后一维永远是 （0, 0, 0, 1），所以可以使用 3x4的矩阵（三个float4）代替，这样就减少了数据传递的压力。</p>
<p>现在所有的骨骼变换矩阵已经传递到 Shader 中了，就可以使用这些数据来蒙皮（变换顶点坐标）</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 模型确定为 24 个骨骼</span></div><div class="line"><span class="comment">// 不同的设备对常量寄存器存储的最大数据量都是有差别的，这一点需要注意</span></div><div class="line">uniform float4x4 _Matrices[<span class="number">24</span>];</div><div class="line"></div><div class="line"><span class="keyword">struct</span> appdata</div><div class="line">&#123;</div><div class="line">    float4 vertex : POSITION;</div><div class="line">    float2 uv : TEXCOORD0;</div><div class="line">    <span class="comment">// tangent 存储了骨骼索引和权重</span></div><div class="line">    <span class="comment">// tangent.x 第一根骨骼索引</span></div><div class="line">    <span class="comment">// tangent.y 第一根骨骼权重</span></div><div class="line">    <span class="comment">// tangent.z 第二根骨骼索引</span></div><div class="line">    <span class="comment">// tangent.w 第二根骨骼权重</span></div><div class="line">    float4 tangent : TANGENT;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function">v2f <span class="title">vert</span> (<span class="params">appdata v</span>)</span></div><div class="line">&#123;</div><div class="line">    v2f o;</div><div class="line"></div><div class="line">    <span class="comment">// 蒙皮</span></div><div class="line">    float4 pos = </div><div class="line">        mul(_Matrices[v.tangent.x], v.vertex) * v.tangent.y + </div><div class="line">        mul(_Matrices[v.tangent.z], v.vertex) * v.tangent.w;</div><div class="line"></div><div class="line">    <span class="comment">// 注意，如果用到了 normal，也要像顶点一样经过蒙皮处理哦</span></div><div class="line"></div><div class="line">    o.vertex = mul(UNITY_MATRIX_MVP, pos);</div><div class="line">    o.uv = TRANSFORM_TEX(v.uv, _MainTex);</div><div class="line">    <span class="keyword">return</span> o;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Mesh.tangents 里预先存储了骨骼索引和权重</span></div><div class="line"><span class="comment">// tangent 里只容得下两个骨骼融合</span></div><div class="line">Vector4[] tangents = <span class="keyword">new</span> Vector4[mesh.vertexCount];</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mesh.vertexCount; ++i)</div><div class="line">&#123;</div><div class="line">    BoneWeight boneWeight = mesh.boneWeights[i];</div><div class="line">    tangents[i].x = boneWeight.boneIndex0;</div><div class="line">    tangents[i].y = boneWeight.weight0;</div><div class="line">    tangents[i].z = boneWeight.boneIndex1;</div><div class="line">    tangents[i].w = boneWeight.weight1;</div><div class="line">&#125;</div><div class="line">newMesh.tangents = tangents;</div></pre></td></tr></table></figure>
<h2 id="其他可以同时进行的优化方案"><a href="#其他可以同时进行的优化方案" class="headerlink" title="其他可以同时进行的优化方案"></a>其他可以同时进行的优化方案</h2><ol>
<li>除了使用GPUSkinning之外们还可以选择使用层次细节（LOD），它是根据物体在游戏画面中所占视图的百分比来调用不同复杂度的模型的。简单而言，就是当一个物体距离摄像机比较远的时候使用低模，当物体距离摄像机比较近的时候使用高模。这是一种优化游戏渲染效率的常用方法，缺点是占用大量内存。使用这个技术，一般是在解决运行时流畅度的问题，采用的是空间换时间的方式。<br><strong>结合GPUSkinning与LOD将会大大提高同屏数量，同时相应的画面会有所降低。可根据实际情况进行处理。</strong></li>
</ol>
<ol>
<li>启用多线程渲染(Multithreading render) ，启用多线程渲染之后渲染效率高出一半左右。原理是将Mesh渲染任务交给另外的渲染进程以此降低当前进程的渲染耗时。<br><img src="/uploads/QQ20180919-145406.png" alt=""><br><img src="/uploads/multithreaded_rendering_0.png" alt=""></li>
</ol>
<ol>
<li>在模型上启用Optmize GameObject降低CPU耗时<br>启用Optmize GameObject之前<br><img src="/uploads/QQ20180919-150059.png" alt=""><br>启用Optmize GameObject之后<br><img src="/uploads/QQ20180919-150223.png" alt=""><br>Optmize GameObject会极大降低骨骼数目对多线程的影响，从而达到降低主线程的CPU耗时。</li>
</ol>
<p>本文部分内容参考如下链接:<br><a href="http://chengkehan.github.io/GPUSkinning.html" target="_blank" rel="external">🔗 GPU Skinning -Jim’s GameDev Blog</a><br><a href="https://v.qq.com/x/page/s05175xbjvd.html" target="_blank" rel="external">🔗 Unity中动画系统的性能优化方案-uwa</a><br><a href="https://www.youtube.com/watch?v=uDqjIdI4bF4&amp;t=660s" target="_blank" rel="external">🔗 YouTube 12 Principles of Animation</a><br><a href="https://blog.csdn.net/n5/article/details/3105872" target="_blank" rel="external">🔗 Skinned Mesh原理解析和一个最简单的实现示例</a><br><a href="hhttps://docs.unity3d.com/Manual/class-SkinnedMeshRenderer.html" target="_blank" rel="external">🔗 Unity官方文档 Skinned Mesh Renderer</a></p>
</div><div class="tags"><a href="/tags/GPUSkinning/">GPUSkinning</a></div><div class="post-nav"><a class="pre" href="/posts/323c9fde/">UNITY3D Playables API实践(下)</a><a class="next" href="/posts/5df16bd2/">UNITY3D Playables API 实践(上)</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'KeyleXiao',
  repo: 'keylexiao.github.io',
  oauth: {
    client_id: '848c90c8264323450559',
    client_secret: '4bb4f2730d20b2e39151a6ed21a7eb0467581baa',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://vrast.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Profile/">Android Profile</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Studio/">Android Studio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/AndroidStudio/">AndroidStudio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/AppStore/">AppStore</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C#</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Document/">Document</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DotNetCore/">DotNetCore</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Editor/">Editor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FAQ/">FAQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Framework/">Framework</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Host/">Host</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/INTENSE项目源码分析/">INTENSE项目源码分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MAC/">MAC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenSource/">OpenSource</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PROJECT/">PROJECT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Plugin/">Plugin</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SCRIPT/">SCRIPT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SDK/">SDK</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Script/">Script</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Site/">Site</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/StrangeIOC教程目录/">StrangeIOC教程目录</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Terminal/">Terminal</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/UNITY/">UNITY</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/UNITY3D/">UNITY3D</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/UNITY3D-iOS/">UNITY3D&iOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/UNITYAPI/">UNITYAPI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/XCode/">XCode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ftp/">ftp</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gantt-chart/">gantt chart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/teranimal/">teranimal</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/图形学/">图形学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习手札/">学习手札</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/新书提纲/">新书提纲</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/源码分析/">源码分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译/">翻译</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/阅读笔记/">阅读笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/ScrollView/" style="font-size: 15px;">ScrollView</a> <a href="/tags/AssetBundle/" style="font-size: 15px;">AssetBundle</a> <a href="/tags/ADB/" style="font-size: 15px;">ADB</a> <a href="/tags/terminal/" style="font-size: 15px;">terminal</a> <a href="/tags/jar/" style="font-size: 15px;">jar</a> <a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a> <a href="/tags/IAP/" style="font-size: 15px;">IAP</a> <a href="/tags/shader-图形学/" style="font-size: 15px;">shader 图形学</a> <a href="/tags/Navigation/" style="font-size: 15px;">Navigation</a> <a href="/tags/C/" style="font-size: 15px;">C#</a> <a href="/tags/AVD/" style="font-size: 15px;">AVD</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/INTENSE-GOAP文档/" style="font-size: 15px;">INTENSE GOAP文档</a> <a href="/tags/INTENSE文档/" style="font-size: 15px;">INTENSE文档</a> <a href="/tags/Grammar/" style="font-size: 15px;">Grammar</a> <a href="/tags/Exception/" style="font-size: 15px;">Exception</a> <a href="/tags/Extension/" style="font-size: 15px;">Extension</a> <a href="/tags/ExcFoundation-framework/" style="font-size: 15px;">ExcFoundation framework</a> <a href="/tags/GCD/" style="font-size: 15px;">GCD</a> <a href="/tags/GPUSkinning/" style="font-size: 15px;">GPUSkinning</a> <a href="/tags/Shader/" style="font-size: 15px;">Shader</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Optimize/" style="font-size: 15px;">Optimize</a> <a href="/tags/INTENSE总纲/" style="font-size: 15px;">INTENSE总纲</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Objective-C/" style="font-size: 15px;">Objective-C</a> <a href="/tags/Lua/" style="font-size: 15px;">Lua</a> <a href="/tags/KVO/" style="font-size: 15px;">KVO</a> <a href="/tags/KVC/" style="font-size: 15px;">KVC</a> <a href="/tags/LipSync/" style="font-size: 15px;">LipSync</a> <a href="/tags/MD5withRSA/" style="font-size: 15px;">MD5withRSA</a> <a href="/tags/markdown-语法/" style="font-size: 15px;">markdown 语法</a> <a href="/tags/Math/" style="font-size: 15px;">Math</a> <a href="/tags/MAC/" style="font-size: 15px;">MAC</a> <a href="/tags/UNITY3D/" style="font-size: 15px;">UNITY3D</a> <a href="/tags/Protocal/" style="font-size: 15px;">Protocal</a> <a href="/tags/SNFramework/" style="font-size: 15px;">SNFramework</a> <a href="/tags/sharderforge/" style="font-size: 15px;">sharderforge</a> <a href="/tags/rendertexure/" style="font-size: 15px;">rendertexure</a> <a href="/tags/Interaction/" style="font-size: 15px;">Interaction</a> <a href="/tags/StrangeIOC/" style="font-size: 15px;">StrangeIOC</a> <a href="/tags/SmartDataViewer/" style="font-size: 15px;">SmartDataViewer</a> <a href="/tags/CODE/" style="font-size: 15px;">CODE</a> <a href="/tags/ANIMATION/" style="font-size: 15px;">ANIMATION</a> <a href="/tags/Define/" style="font-size: 15px;">Define</a> <a href="/tags/性能优化/" style="font-size: 15px;">性能优化</a> <a href="/tags/UI/" style="font-size: 15px;">UI</a> <a href="/tags/AI/" style="font-size: 15px;">AI</a> <a href="/tags/coroutines/" style="font-size: 15px;">coroutines</a> <a href="/tags/NewPrefabSystem/" style="font-size: 15px;">NewPrefabSystem</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/测试自动化/" style="font-size: 15px;">测试自动化</a> <a href="/tags/UniwebView/" style="font-size: 15px;">UniwebView</a> <a href="/tags/UNITY3D编辑器/" style="font-size: 15px;">UNITY3D编辑器</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Cocopods/" style="font-size: 15px;">Cocopods</a> <a href="/tags/YouMi/" style="font-size: 15px;">YouMi</a> <a href="/tags/MOBILE/" style="font-size: 15px;">MOBILE</a> <a href="/tags/Plugins/" style="font-size: 15px;">Plugins</a> <a href="/tags/XLua/" style="font-size: 15px;">XLua</a> <a href="/tags/Graphic/" style="font-size: 15px;">Graphic</a> <a href="/tags/download/" style="font-size: 15px;">download</a> <a href="/tags/none/" style="font-size: 15px;">none</a> <a href="/tags/protobuf/" style="font-size: 15px;">protobuf</a> <a href="/tags/ZSH/" style="font-size: 15px;">ZSH</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/VIM/" style="font-size: 15px;">VIM</a> <a href="/tags/XCode/" style="font-size: 15px;">XCode</a> <a href="/tags/3DUI/" style="font-size: 15px;">3DUI</a> <a href="/tags/VSCode/" style="font-size: 15px;">VSCode</a> <a href="/tags/BuildTimes/" style="font-size: 15px;">BuildTimes</a> <a href="/tags/APK/" style="font-size: 15px;">APK</a> <a href="/tags/Plugin/" style="font-size: 15px;">Plugin</a> <a href="/tags/计划与时间管理/" style="font-size: 15px;">计划与时间管理</a> <a href="/tags/md5/" style="font-size: 15px;">md5</a> <a href="/tags/None/" style="font-size: 15px;">None</a> <a href="/tags/NavmeshAgent/" style="font-size: 15px;">NavmeshAgent</a> <a href="/tags/Physics/" style="font-size: 15px;">Physics</a> <a href="/tags/缺氧源码分析/" style="font-size: 15px;">缺氧源码分析</a> <a href="/tags/tools/" style="font-size: 15px;">tools</a> <a href="/tags/PROJECT/" style="font-size: 15px;">PROJECT</a> <a href="/tags/语法/" style="font-size: 15px;">语法</a> <a href="/tags/微软跨平台/" style="font-size: 15px;">微软跨平台</a> <a href="/tags/Terminal/" style="font-size: 15px;">Terminal</a> <a href="/tags/Tencent/" style="font-size: 15px;">Tencent</a> <a href="/tags/English/" style="font-size: 15px;">English</a> <a href="/tags/Observer/" style="font-size: 15px;">Observer</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/Chat/" style="font-size: 15px;">Chat</a> <a href="/tags/PerGUI/" style="font-size: 15px;">PerGUI</a> <a href="/tags/Git技巧/" style="font-size: 15px;">Git技巧</a> <a href="/tags/ANDROID/" style="font-size: 15px;">ANDROID</a> <a href="/tags/SublimeText3/" style="font-size: 15px;">SublimeText3</a> <a href="/tags/project/" style="font-size: 15px;">project</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/d2e8872a/">http下载与ftp下载md5值不一致</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2a8fe98b/">使用ternimal 或 powershell 计算文件md5</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/55eaddde/">AndroidStudio AVD FAQ</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/cd9ab0aa/">JIT && TOC</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/5b921b24/">none内容提纲</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/47642b6e/">使用VisualStudio Code 预览.md文件</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/d708212d/">Mac平台Debug lua提示缺少socket.http组件</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/80d969f4/">UNITY Unable to instantiate UnityPlayerActivity</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/b5ee8b26/">优化IL2CPP打包速度</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/434d7425/">安装Unity导出APK显示失败</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/KeyleXiao" title="My GitHub" target="_blank">My GitHub</a><ul></ul><a href="https://twitter.com/keyle_xiao" title="My Twitter" target="_blank">My Twitter</a><ul></ul><a href="http://weibo.com/xiaoxiaoxiaonian" title="My Weibo" target="_blank">My Weibo</a><ul></ul><a href="http://git.oschina.net/keyle" title="My OSChina" target="_blank">My OSChina</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer"> <p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold;">Coding Pages</a></p><br/> 本站由 <a href="https://vrast.cn/about">@keyle </a> 创建，采用 <a href="https://github.com/tufu9441/maupassant-hexo">Maupassant</a> 作为主题，您可以在 <a href="https://github.com/KeyleXiao/keylexiao.github.io">GitHub</a> 找到本站源码<br/> © <a href="/." rel="nofollow">Lazybones Kill PLAN . </a> 本站采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/cn/">署名-非商业性使用-相同方式共享 2.5 中国大陆</a>进行许可 <br/><a class="fa fa-envelope-o" href="mailto:keyle_xiao@hotmail.com"> keyle_xiao@hotmail.com  .</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>