<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lazybones Kill PLAN</title>
  <subtitle>In me the tiger sniffs the rose</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://vrast.cn/"/>
  <updated>2017-12-17T11:42:34.163Z</updated>
  <id>http://vrast.cn/</id>
  
  <author>
    <name>keyle xiao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用物理检测范围与距离内的目标</title>
    <link href="http://vrast.cn/posts/e0406d64/"/>
    <id>http://vrast.cn/posts/e0406d64/</id>
    <published>2017-12-16T16:30:27.000Z</published>
    <updated>2017-12-17T11:42:34.163Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>分享一个技围检测脚本，用来判定范围内是否有目标，或者是线性范围内是否可见目标。</p>
</blockquote>
<p><img src="/uploads/ScreenShot2017-12-17.png" alt="简洁范围检测"><br><a id="more"></a></p>
<h1 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CheckSkillRange</span> : <span class="title">MonoBehaviour</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">public</span> Vector3 offset = Vector3.one;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">float</span> fieldOfViewAngle = <span class="number">20</span>;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">float</span> viewDistance = <span class="number">4</span>;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">bool</span> usePhysics2D = <span class="literal">false</span>;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> LayerMask ObjLayer = LayerMask.GetMask(<span class="string">"Default"</span>);</div><div class="line">  <span class="keyword">public</span> LayerMask IgnoreLayer = <span class="number">1</span>;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (Input.GetMouseButtonUp(<span class="number">1</span>))</div><div class="line">    &#123;</div><div class="line">      <span class="keyword">var</span> o = MovementUtility.WithinSight(transform, offset, fieldOfViewAngle, viewDistance, ObjLayer, Vector3.zero, IgnoreLayer);</div><div class="line">      <span class="keyword">if</span> (o)</div><div class="line">      &#123;</div><div class="line">        Debug.Log(<span class="keyword">string</span>.Format(<span class="string">"Attack obj &#123;0&#125;"</span>, o.name));</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">// Draw the line of sight representation within the scene window</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDrawGizmos</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">    DrawLineOfSight(<span class="keyword">this</span>.transform, offset, fieldOfViewAngle, viewDistance, usePhysics2D);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DrawLineOfSight</span>(<span class="params">Transform transform, Vector3 positionOffset, <span class="keyword">float</span> fieldOfViewAngle, <span class="keyword">float</span> viewDistance, <span class="keyword">bool</span> usePhysics2D</span>)</span></div><div class="line">  &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></div><div class="line">    <span class="keyword">var</span> oldColor = UnityEditor.Handles.color;</div><div class="line">    <span class="keyword">var</span> color = Color.yellow;</div><div class="line">    color.a = <span class="number">0.1</span>f;</div><div class="line">    UnityEditor.Handles.color = color;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> halfFOV = fieldOfViewAngle * <span class="number">0.5</span>f;</div><div class="line">    <span class="keyword">var</span> beginDirection = Quaternion.AngleAxis(-halfFOV, (usePhysics2D ? Vector3.forward : Vector3.up)) * (usePhysics2D ? transform.up : transform.forward);</div><div class="line">    UnityEditor.Handles.DrawSolidArc(transform.TransformPoint(positionOffset), (usePhysics2D ? transform.forward : transform.up), beginDirection, fieldOfViewAngle, viewDistance);</div><div class="line"></div><div class="line">    UnityEditor.Handles.color = oldColor;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="核心类，使用物理检测距离目标等-核心还是使用了碰撞检测"><a href="#核心类，使用物理检测距离目标等-核心还是使用了碰撞检测" class="headerlink" title="核心类，使用物理检测距离目标等,核心还是使用了碰撞检测"></a>核心类，使用物理检测距离目标等,核心还是使用了碰撞检测</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MovementUtility</span></div><div class="line">&#123;</div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// Static Fields</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Dictionary&lt;GameObject, AudioSource[]&gt; transformAudioSourceMap;</div><div class="line"></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// Static Methods</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DrawLineOfSight</span>(<span class="params">Transform transform, Vector3 positionOffset, <span class="keyword">float</span> fieldOfViewAngle, <span class="keyword">float</span> angleOffset, <span class="keyword">float</span> viewDistance, <span class="keyword">bool</span> usePhysics2D</span>)</span></div><div class="line">  &#123;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> AudioSource[] <span class="title">GetAudioSources</span>(<span class="params">GameObject target</span>)</span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">bool</span> flag = MovementUtility.transformAudioSourceMap == <span class="literal">null</span>;</div><div class="line">    <span class="keyword">if</span> (flag)</div><div class="line">    &#123;</div><div class="line">      MovementUtility.transformAudioSourceMap = <span class="keyword">new</span> Dictionary&lt;GameObject, AudioSource[]&gt;();</div><div class="line">    &#125;</div><div class="line">    AudioSource[] componentsInChildren;</div><div class="line">    <span class="keyword">bool</span> flag2 = MovementUtility.transformAudioSourceMap.TryGetValue(target, <span class="keyword">out</span> componentsInChildren);</div><div class="line">    AudioSource[] result;</div><div class="line">    <span class="keyword">if</span> (flag2)</div><div class="line">    &#123;</div><div class="line">      result = componentsInChildren;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">      componentsInChildren = target.GetComponentsInChildren&lt;AudioSource&gt;();</div><div class="line">      MovementUtility.transformAudioSourceMap.Add(target, componentsInChildren);</div><div class="line">      result = componentsInChildren;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameObject <span class="title">LineOfSight</span>(<span class="params">Transform transform, Vector3 positionOffset, GameObject targetObject, Vector3 targetOffset, <span class="keyword">bool</span> usePhysics2D, <span class="keyword">int</span> ignoreLayerMask</span>)</span></div><div class="line">  &#123;</div><div class="line">    GameObject result;</div><div class="line">    <span class="keyword">if</span> (usePhysics2D)</div><div class="line">    &#123;</div><div class="line">      RaycastHit2D raycastHit2D;</div><div class="line">      <span class="keyword">bool</span> flag = raycastHit2D = Physics2D.Linecast(transform.TransformPoint(positionOffset), targetObject.transform.TransformPoint(targetOffset), ~ignoreLayerMask);</div><div class="line">      <span class="keyword">if</span> (flag)</div><div class="line">      &#123;</div><div class="line">        <span class="keyword">bool</span> flag2 = raycastHit2D.transform.IsChildOf(targetObject.transform) || targetObject.transform.IsChildOf(raycastHit2D.transform);</div><div class="line">        <span class="keyword">if</span> (flag2)</div><div class="line">        &#123;</div><div class="line">          result = targetObject;</div><div class="line">          <span class="keyword">return</span> result;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">      RaycastHit raycastHit;</div><div class="line"></div><div class="line">      <span class="keyword">bool</span> flag3 = Physics.Linecast(transform.TransformPoint(positionOffset), targetObject.transform.TransformPoint(targetOffset), <span class="keyword">out</span> raycastHit, ~ignoreLayerMask);</div><div class="line">      <span class="keyword">if</span> (flag3)</div><div class="line">      &#123;</div><div class="line">        <span class="keyword">bool</span> flag4 = raycastHit.transform.IsChildOf(targetObject.transform) || targetObject.transform.IsChildOf(raycastHit.transform);</div><div class="line">        <span class="keyword">if</span> (flag4)</div><div class="line">        &#123;</div><div class="line">          result = targetObject;</div><div class="line">          <span class="keyword">return</span> result;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    result = <span class="literal">null</span>;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameObject <span class="title">WithinHearingRange2D</span>(<span class="params">Transform transform, Vector3 positionOffset, <span class="keyword">float</span> audibilityThreshold, <span class="keyword">float</span> hearingRadius, LayerMask objectLayerMask</span>)</span></div><div class="line">  &#123;</div><div class="line">    GameObject result = <span class="literal">null</span>;</div><div class="line">    Collider2D[] array = Physics2D.OverlapCircleAll(transform.TransformPoint(positionOffset), hearingRadius, objectLayerMask);</div><div class="line">    <span class="keyword">bool</span> flag = array != <span class="literal">null</span>;</div><div class="line">    <span class="keyword">if</span> (flag)</div><div class="line">    &#123;</div><div class="line">      <span class="keyword">float</span> num = <span class="number">0</span>f;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.Length; i++)</div><div class="line">      &#123;</div><div class="line">        <span class="keyword">float</span> num2 = <span class="number">0</span>f;</div><div class="line">        GameObject gameObject;</div><div class="line">        <span class="keyword">bool</span> flag2 = (gameObject = MovementUtility.WithinHearingRange(transform, positionOffset, audibilityThreshold, array[i].gameObject, <span class="keyword">ref</span> num2)) != <span class="literal">null</span>;</div><div class="line">        <span class="keyword">if</span> (flag2)</div><div class="line">        &#123;</div><div class="line">          <span class="keyword">bool</span> flag3 = num2 &gt; num;</div><div class="line">          <span class="keyword">if</span> (flag3)</div><div class="line">          &#123;</div><div class="line">            num = num2;</div><div class="line">            result = gameObject;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameObject <span class="title">WithinSight</span>(<span class="params">Transform transform, Vector3 positionOffset, <span class="keyword">float</span> fieldOfViewAngle, <span class="keyword">float</span> viewDistance, LayerMask objectLayerMask, Vector3 targetOffset, LayerMask ignoreLayerMask</span>)</span></div><div class="line">  &#123;</div><div class="line">    GameObject result = <span class="literal">null</span>;</div><div class="line">    Collider[] array = Physics.OverlapSphere(transform.position, viewDistance, objectLayerMask);</div><div class="line">    <span class="keyword">bool</span> flag = array != <span class="literal">null</span>;</div><div class="line">    <span class="keyword">if</span> (flag)</div><div class="line">    &#123;</div><div class="line">      <span class="keyword">float</span> num = <span class="keyword">float</span>.PositiveInfinity;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.Length; i++)</div><div class="line">      &#123;</div><div class="line">        <span class="keyword">float</span> num2;</div><div class="line">        GameObject gameObject;</div><div class="line">        <span class="keyword">bool</span> flag2 = (gameObject = MovementUtility.WithinSight(transform, positionOffset, fieldOfViewAngle, viewDistance, array[i].gameObject, targetOffset, <span class="literal">false</span>, <span class="number">0</span>f, <span class="keyword">out</span> num2, ignoreLayerMask)) != <span class="literal">null</span>;</div><div class="line">        <span class="keyword">if</span> (flag2)</div><div class="line">        &#123;</div><div class="line">          <span class="keyword">bool</span> flag3 = num2 &lt; num;</div><div class="line">          <span class="keyword">if</span> (flag3)</div><div class="line">          &#123;</div><div class="line">            num = num2;</div><div class="line">            result = gameObject;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameObject <span class="title">WithinSight</span>(<span class="params">Transform transform, Vector3 positionOffset, <span class="keyword">float</span> fieldOfViewAngle, <span class="keyword">float</span> viewDistance, GameObject targetObject, Vector3 targetOffset, LayerMask ignoreLayerMask</span>)</span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">float</span> num;</div><div class="line">    <span class="keyword">return</span> MovementUtility.WithinSight(transform, positionOffset, fieldOfViewAngle, viewDistance, targetObject, targetOffset, <span class="literal">false</span>, <span class="number">0</span>f, <span class="keyword">out</span> num, ignoreLayerMask);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> GameObject <span class="title">WithinSight</span>(<span class="params">Transform transform, Vector3 positionOffset, <span class="keyword">float</span> fieldOfViewAngle, <span class="keyword">float</span> viewDistance, GameObject targetObject, Vector3 targetOffset, <span class="keyword">bool</span> usePhysics2D, <span class="keyword">float</span> angleOffset2D, <span class="keyword">out</span> <span class="keyword">float</span> angle, <span class="keyword">int</span> ignoreLayerMask</span>)</span></div><div class="line">  &#123;</div><div class="line">    Vector3 vector = targetObject.transform.position - transform.TransformPoint(positionOffset);</div><div class="line">    <span class="keyword">if</span> (usePhysics2D)</div><div class="line">    &#123;</div><div class="line">      angle = Vector3.Angle(vector, transform.up) + angleOffset2D;</div><div class="line">      vector.z = <span class="number">0</span>f;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">      angle = Vector3.Angle(vector, transform.forward);</div><div class="line">      vector.y = <span class="number">0</span>f;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">bool</span> flag = vector.magnitude &lt; viewDistance &amp;&amp; angle &lt; fieldOfViewAngle * <span class="number">0.5</span>f;</div><div class="line">    GameObject result;</div><div class="line">    <span class="keyword">if</span> (flag)</div><div class="line">    &#123;</div><div class="line">      <span class="keyword">bool</span> flag2 = MovementUtility.LineOfSight(transform, positionOffset, targetObject, targetOffset, usePhysics2D, ignoreLayerMask) != <span class="literal">null</span>;</div><div class="line">      <span class="keyword">if</span> (flag2)</div><div class="line">      &#123;</div><div class="line">        result = targetObject;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">bool</span> flag3 = targetObject.GetComponent&lt;Collider&gt;() == <span class="literal">null</span> &amp;&amp; targetObject.GetComponent&lt;Collider2D&gt;() == <span class="literal">null</span>;</div><div class="line">      <span class="keyword">if</span> (flag3)</div><div class="line">      &#123;</div><div class="line">        <span class="keyword">bool</span> activeSelf = targetObject.gameObject.activeSelf;</div><div class="line">        <span class="keyword">if</span> (activeSelf)</div><div class="line">        &#123;</div><div class="line">          result = targetObject;</div><div class="line">          <span class="keyword">return</span> result;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    result = <span class="literal">null</span>;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameObject <span class="title">WithinSight2D</span>(<span class="params">Transform transform, Vector3 positionOffset, <span class="keyword">float</span> fieldOfViewAngle, <span class="keyword">float</span> viewDistance, LayerMask objectLayerMask, Vector3 targetOffset, <span class="keyword">float</span> angleOffset2D, LayerMask ignoreLayerMask</span>)</span></div><div class="line">  &#123;</div><div class="line">    GameObject result = <span class="literal">null</span>;</div><div class="line">    Collider2D[] array = Physics2D.OverlapCircleAll(transform.position, viewDistance, objectLayerMask);</div><div class="line">    <span class="keyword">bool</span> flag = array != <span class="literal">null</span>;</div><div class="line">    <span class="keyword">if</span> (flag)</div><div class="line">    &#123;</div><div class="line">      <span class="keyword">float</span> num = <span class="keyword">float</span>.PositiveInfinity;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.Length; i++)</div><div class="line">      &#123;</div><div class="line">        <span class="keyword">float</span> num2;</div><div class="line">        GameObject gameObject;</div><div class="line">        <span class="keyword">bool</span> flag2 = (gameObject = MovementUtility.WithinSight(transform, positionOffset, fieldOfViewAngle, viewDistance, array[i].gameObject, targetOffset, <span class="literal">true</span>, angleOffset2D, <span class="keyword">out</span> num2, ignoreLayerMask)) != <span class="literal">null</span>;</div><div class="line">        <span class="keyword">if</span> (flag2)</div><div class="line">        &#123;</div><div class="line">          <span class="keyword">bool</span> flag3 = num2 &lt; num;</div><div class="line">          <span class="keyword">if</span> (flag3)</div><div class="line">          &#123;</div><div class="line">            num = num2;</div><div class="line">            result = gameObject;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameObject <span class="title">WithinSight2D</span>(<span class="params">Transform transform, Vector3 positionOffset, <span class="keyword">float</span> fieldOfViewAngle, <span class="keyword">float</span> viewDistance, GameObject targetObject, Vector3 targetOffset, <span class="keyword">float</span> angleOffset2D, LayerMask ignoreLayerMask</span>)</span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">float</span> num;</div><div class="line">    <span class="keyword">return</span> MovementUtility.WithinSight(transform, positionOffset, fieldOfViewAngle, viewDistance, targetObject, targetOffset, <span class="literal">true</span>, angleOffset2D, <span class="keyword">out</span> num, ignoreLayerMask);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;分享一个技围检测脚本，用来判定范围内是否有目标，或者是线性范围内是否可见目标。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/uploads/ScreenShot2017-12-17.png&quot; alt=&quot;简洁范围检测&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="UNITY3D" scheme="http://vrast.cn/categories/UNITY3D/"/>
    
    
      <category term="Physics" scheme="http://vrast.cn/tags/Physics/"/>
    
  </entry>
  
  <entry>
    <title>解决NavmeshAgent寻路边界的判定</title>
    <link href="http://vrast.cn/posts/e53ade9f/"/>
    <id>http://vrast.cn/posts/e53ade9f/</id>
    <published>2017-12-15T14:36:00.000Z</published>
    <updated>2017-12-15T15:03:56.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>今天群里有兄弟问: “我看到navmeshagent里面有个方法叫什么获取网格边缘点的，我打算首先判断目标点在不在网格上。在的话正常逻辑，不在的话判断当前agent的位置有没有到那个边缘点 “ 。我想这样应该能解决这个问题。</p>
</blockquote>
<p><img src="/uploads/FC9B64C1057D31F1B4692EF0EC22A08B.jpg" alt="解决边界点的判定"></p>
<a id="more"></a>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (Input.GetMouseButtonDown(<span class="number">1</span>))</div><div class="line">&#123;</div><div class="line">    NavMeshHit hit;</div><div class="line">    NavMesh.Raycast(transform.position, target.position, <span class="keyword">out</span> hit, <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (hit.hit)</div><div class="line">    &#123;</div><div class="line">        NavMeshPath path = <span class="keyword">new</span> NavMeshPath();</div><div class="line">        <span class="keyword">if</span> (agent.CalculatePath(hit.position, path))</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">var</span> pos = path.corners[path.corners.Length - <span class="number">1</span>];</div><div class="line">            <span class="keyword">var</span> o = GameObject.CreatePrimitive(PrimitiveType.Sphere);</div><div class="line">            o.transform.localScale = Vector3.one * <span class="number">0.1</span>f;</div><div class="line">            o.transform.position = pos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;今天群里有兄弟问: “我看到navmeshagent里面有个方法叫什么获取网格边缘点的，我打算首先判断目标点在不在网格上。在的话正常逻辑，不在的话判断当前agent的位置有没有到那个边缘点 “ 。我想这样应该能解决这个问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/uploads/FC9B64C1057D31F1B4692EF0EC22A08B.jpg&quot; alt=&quot;解决边界点的判定&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="UNITY3D" scheme="http://vrast.cn/categories/UNITY3D/"/>
    
    
      <category term="NavmeshAgent" scheme="http://vrast.cn/tags/NavmeshAgent/"/>
    
  </entry>
  
  <entry>
    <title>High-level NavMesh Building Components</title>
    <link href="http://vrast.cn/posts/98dfcd51/"/>
    <id>http://vrast.cn/posts/98dfcd51/</id>
    <published>2017-12-07T12:49:15.000Z</published>
    <updated>2017-12-08T03:10:38.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>高级 NavMesh 组件说明文档</p>
</blockquote>
<p>NavMesh Surface 脚本 ，在此之前 我看了网络上的一篇介绍 <a href="http://forum.china.unity3d.com/thread-25421-1-1.html" target="_blank" rel="external">进击的新版NavMesh系统：看我飞檐走壁</a> 效果非常好。我一边测试一边记录关于Surface的用法。</p>
<p>NavMesh Surcefa组件表示特定NavMeshAgent类型的可行走区域，并定义应该构建NavMesh的场景的一部分。</p>
<p>NavMesh Surface组件不在标准Unity安装中; 有关如何访问它的信息，<a href="https://docs.unity3d.com/Manual/class-NavMeshSurface.html" target="_blank" rel="external">请参阅高级NavMesh构建组件的文档</a>。</p>
<p>要使用NavMesh Surface组件，导航到GameObject&gt; AI&gt; NavMesh Surface。 这将创建一个空的GameObject，并附带一个NavMesh Surface组件。 一个场景可以包含多个NavMesh表面。</p>
<a id="more"></a>
<p><img src="/uploads/class-NavMeshSurface-0.png" alt="嗯 就是这货了"></p>
<p><img src="/uploads/QQ20171207-161002@2x.png" alt="针对与这个组件的使用说明"></p>
<p><img src="/uploads/QQ20171207-162319.png" alt="NavMesh Surface参数说明"></p>
<blockquote>
<p>NavMesh Off-Link &amp;  Off-mesh-Link 我们通常用第一种。在两个不可行走区域之间 使用跨越点+动画 实现定点跳跃。</p>
</blockquote>
<p><img src="/uploads/QQ20171207-194954.png" alt="Off Link"><br><img src="/uploads/QQ20171207-195557.png" alt="Off Link"></p>
<blockquote>
<p>NavMesh Modifier &amp; NavMesh Modifier Volume 在烘培之前修改区域是否行走</p>
</blockquote>
<p>先说 NavMesh Modifier volume,你可以在烘培之前选定区域设置区域类型，例子将某个Agent设置成该区域不能行走。</p>
<p><img src="/uploads/class-NavMesh-ModifierVolume-4.png" alt="NavMesh Modifier Volume效果图"></p>
<!-- more -->
<p><img src="/uploads/QQ20171207-193142@2x.png" alt="NavMesh Modifier Volume使用方法"></p>
<p>如果知道了 NavMesh Modifier Volume 那么可以猜得到  NavMesh Modifier 就是给附着这个脚本的mesh上的区域设置区域类型。</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;高级 NavMesh 组件说明文档&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;NavMesh Surface 脚本 ，在此之前 我看了网络上的一篇介绍 &lt;a href=&quot;http://forum.china.unity3d.com/thread-25421-1-1.html&quot;&gt;进击的新版NavMesh系统：看我飞檐走壁&lt;/a&gt; 效果非常好。我一边测试一边记录关于Surface的用法。&lt;/p&gt;
&lt;p&gt;NavMesh Surcefa组件表示特定NavMeshAgent类型的可行走区域，并定义应该构建NavMesh的场景的一部分。&lt;/p&gt;
&lt;p&gt;NavMesh Surface组件不在标准Unity安装中; 有关如何访问它的信息，&lt;a href=&quot;https://docs.unity3d.com/Manual/class-NavMeshSurface.html&quot;&gt;请参阅高级NavMesh构建组件的文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;要使用NavMesh Surface组件，导航到GameObject&amp;gt; AI&amp;gt; NavMesh Surface。 这将创建一个空的GameObject，并附带一个NavMesh Surface组件。 一个场景可以包含多个NavMesh表面。&lt;/p&gt;
    
    </summary>
    
      <category term="UNITY3D" scheme="http://vrast.cn/categories/UNITY3D/"/>
    
    
      <category term="Navigation" scheme="http://vrast.cn/tags/Navigation/"/>
    
  </entry>
  
  <entry>
    <title>Building a NavMesh</title>
    <link href="http://vrast.cn/posts/33160c87/"/>
    <id>http://vrast.cn/posts/33160c87/</id>
    <published>2017-12-07T05:50:59.000Z</published>
    <updated>2017-12-07T08:58:46.123Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>创建导航网格与Unity2017面板详细参数说明。</p>
</blockquote>
<a id="more"></a>
<h1 id="创建Navmesh-与-Agent-设置"><a href="#创建Navmesh-与-Agent-设置" class="headerlink" title="创建Navmesh 与 Agent 设置"></a>创建Navmesh 与 Agent 设置</h1><p><img src="/uploads/NavMeshSetupObject.svg" alt="设置网格"></p>
<p><img src="/uploads/NavMeshSetupBake.svg" alt="设置网格烘焙"></p>
<blockquote>
<p>一些你需要知道的参数</p>
</blockquote>
<ul>
<li>Agent半径定义了Agentd的中心可以靠近墙壁或窗台的距离。</li>
<li><p>Agent Radius defines how close the agent center can get to a wall or a ledge.</p>
</li>
<li><p>Agent高度定义Agent可以到达的空间有多低。</p>
</li>
<li><p>Agent Height defines how low the spaces are that the agent can reach.</p>
</li>
<li><p>最大坡度定义了Agent人走上坡道的坡度。</p>
</li>
<li><p>Max Slope defines how steep the ramps are that the agent walk up.</p>
</li>
<li><p>台阶高度定义了Agent可以踩踏的障碍物的高度。</p>
</li>
<li>Step Height defines how high obstructions are that the agent can step on.</li>
</ul>
<p><img src="/uploads/NavMeshAsset.svg" alt="烘培好的网格会在Scene的同名目录内"></p>
<blockquote>
<p>Navmesh bake 高级烘焙设置</p>
</blockquote>
<h1 id="Min-Region-Area"><a href="#Min-Region-Area" class="headerlink" title="Min Region Area"></a>Min Region Area</h1><p><img src="/uploads/NavMeshMinRegion.svg" alt="最小烘焙区域，最小区域高级构建设置允许您清除小的未连接的NavMesh区域。 比表面积小于指定值的NavMesh区域将被移除。"></p>
<h1 id="更小的代理半径"><a href="#更小的代理半径" class="headerlink" title="更小的代理半径"></a>更小的代理半径</h1><p>Voxel Size<br><img src="/uploads/QQ20171207-143312@2x.png" alt="体素尺寸"></p>
<p>手动更改体素允许您更改烘烤过程的准确性。</p>
<p>NavMesh烘焙过程使用体素化从任意级别的几何构建NavMesh。 在算法的第一遍中，场景被光栅化成体素，然后提取步行表面，最后将步进表面变成导航网格。 体素大小描述了由此产生的NavMesh如何准确地表示场景几何。</p>
<p>默认精度设置为每个Agent半径有3个体素，即整个Agent宽度为6个体素。 这是精度和烘烤速度之间的良好折衷。 将体素大小减半会使内存使用量增加4倍，而构建场景需要花费4倍的时间。</p>
<p>NavMesh烘烤系统也将减小体素的大小。 如果您的其他Agent维度保持不变，则可能不需要增加NavMesh构建分辨率。</p>
<p>最简单的方法如下：</p>
<p>将Agent半径设置为实际Agent半径。<br>打开手动体素大小，这将采取当前体素大小和“冻结”。<br>手动设置更小的Agent半径，因为您已经选中了手动体素大小，体素大小不会改变。</p>
<h1 id="更精确的NavMesh"><a href="#更精确的NavMesh" class="headerlink" title="更精确的NavMesh"></a>更精确的NavMesh</h1><p>如果你的关卡有很多紧凑的点，你可能希望通过缩小体素来提高准确性。 体素大小下的标签显示体素大小和代理半径之间的关系。 一个合理的范围是2-8之间，进一步缩小体素比通常会导致非常长的构建时间。</p>
<p>当您在游戏中有意建造走廊时，请注意，除了代理人半径之外，您还应该至少保留4 * 像素大小的空间，尤其是在走廊处于角度的情况下。<br>如果您需要小于NavMesh烘烤支持的走廊，请考虑使用“Off-Link”跨越点。 这些还有额外的好处，可以在使用时检测到，例如可以播放特定的动画。</p>
<p>More Accurate NavMesh</p>
<p>If your level has a lot of tight spots, you may want to increase the accuracy by making the voxel smaller. The label under the Voxel Size shows the relation between the voxel size and Agent Radius. A good range is something between 2–8, going further than that generally results really long build times.</p>
<p>When you intentionally build tight corridors in your game, please note that you should leave at least 4 * voxelSize clearance in addition to the agent radius, especially if the corridors are at angles.</p>
<p>If you need smaller corridors than the NavMesh baking can support, please consider using Off-Mesh Links. These have the additional benefit that you can detect when they are being used and can, for example, play a specific animation.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;创建导航网格与Unity2017面板详细参数说明。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="UNITY3D" scheme="http://vrast.cn/categories/UNITY3D/"/>
    
    
      <category term="Navigation" scheme="http://vrast.cn/tags/Navigation/"/>
    
  </entry>
  
  <entry>
    <title>Navigation System In Unity</title>
    <link href="http://vrast.cn/posts/671463f1/"/>
    <id>http://vrast.cn/posts/671463f1/</id>
    <published>2017-12-07T02:50:56.000Z</published>
    <updated>2017-12-07T08:08:03.795Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>时间仓促，大部分采用google机器翻译来不及全部校对翻译成中文资料 本篇作为笔记。感兴趣的可以看下。这篇是记录Unity3D寻路的官方文档阅读体验。</p>
</blockquote>
<p>The Navigation System allows you to create characters which can navigate the game world. It gives your characters the ability to understand that they need to take stairs to reach second floor, or to jump to get over a ditch. The Unity NavMesh system consists of the following pieces:</p>
<p>Unity3d的寻路系统大概有下面几个部分：</p>
<p>NavMesh（导航网格的缩写）是描述游戏世界的步行表面的数据结构，并且允许从游戏世界中的一个步行位置到另一个步行路径找到路径。 数据结构是烘焙的网格里获取的。</p>
<p>NavMesh (short for Navigation Mesh) is a data structure which describes the walkable surfaces of the game world and allows to find path from one walkable location to another in the game world. The data structure is built, or baked, automatically from your level geometry.</p>
<p>NavMesh Agent组件帮助您创建角色，在向目标移动时避开彼此。Agent使用NavMesh理解游戏世界，他们知道如何避免彼此以及移动障碍物。<br>离网链接组件允许您合并无法使用可走行的曲面表示的导航快捷方式。 例如，跳过沟渠或栅栏，或者在走过它之前打开门，都可以被描述为“Off-mesh”链接。</p>
<p>NavMesh Agent component help you to create characters which avoid each other while moving towards their goal. Agents reason about the game world using the NavMesh and they know how to avoid each other as well as moving obstacles.<br>Off-Mesh Link component allows you to incorporate navigation shortcuts which cannot be represented using a walkable surface. For example, jumping over a ditch or a fence, or opening a door before walking through it, can be all described as Off-mesh links.</p>
<p>NavMesh障碍组件允许您描述Agent在航行世界时应避免的移动障碍。 物理系统控制的一个桶或一个箱子是一个障碍的好例子。 当障碍物移动时，障碍物尽力避开它，但是一旦障碍物变得静止，它将在导航网上挖一个洞，使得障碍物可以改变它们的路径来绕过障碍物，或者如果障碍物妨碍路径 方式，Agent可以找到不同的路线。</p>
<p>NavMesh Obstacle component allows you to describe moving obstacles the agents should avoid while navigating the world. A barrel or a crate controlled by the physics system is a good example of an obstacle. While the obstacle is moving the agents do their best to avoid it, but once the obstacle becomes stationary it will carve a hole in the navmesh so that the agents can change their paths to steer around it, or if the stationary obstacle is blocking the path way, the agents can find a different route.</p>
<a id="more"></a>
<h1 id="Inner-Workings-of-the-Navigation-System-Navigation的工作原理"><a href="#Inner-Workings-of-the-Navigation-System-Navigation的工作原理" class="headerlink" title="Inner Workings of the Navigation System / Navigation的工作原理"></a>Inner Workings of the Navigation System / Navigation的工作原理</h1><p>当你想智能地移动你的游戏中的角色（或者在AI圈子中被称为Agent）时，你必须解决两个问题：如何推理关卡以找到目的地，然后如何移动到那里。 这两个问题紧密结合在一起，但性质却截然不同。 关于层次的推理问题更加全局化和静态化，因为它考虑了整个场景。 移动到目的地更具局部性和动态性，只考虑移动的方向，以及如何防止与其他移动Agent发生冲突。</p>
<p>When you want to intelligently move characters in your game (or agents as they are called in AI circles), you have to solve two problems: how to reason about the level to find the destination, then how to move there. These two problems are tightly coupled, but quite different in nature. The problem of reasoning about the level is more global and static, in that it takes into account the whole scene. Moving to the destination is more local and dynamic, it only considers the direction to move and how to prevent collisions with other moving agents.</p>
<p><img src="/uploads/NavMeshUnderstandingAreas.png" alt="可行走区域"></p>
<p>导航系统需要自己的数据来表示游戏场景中的可行走区域。 步行区域定义了Agent可以站立和移动的场景中的地点。 在Unity中，Agent被描述为圆柱体。 通过测试Agent站点的位置，可以从场景中的几何结构自动建立可行走区域。 然后，位置连接到场景几何图形上的表面。 这个表面被称为导航网格（简称NavMesh）。</p>
<p>The navigation system needs its own data to represent the walkable areas in a game scene. The walkable areas define the places in the scene where the agent can stand and move. In Unity the agents are described as cylinders. The walkable area is built automatically from the geometry in the scene by testing the locations where the agent can stand. Then the locations are connected to a surface laying on top of the scene geometry. This surface is called the navigation mesh (NavMesh for short).</p>
<p>NavMesh将这个曲面存储为凸多边形。 凸多边形是一个有用的表示，因为我们知道多边形内的任意两点之间没有障碍物。 除了多边形边界之外，我们还存储有关哪些多边形是彼此相邻的信息。 这使我们能够推断整个步行区域。</p>
<p>The NavMesh stores this surface as convex polygons. Convex polygons are a useful representation, since we know that there are no obstructions between any two points inside a polygon. In addition to the polygon boundaries, we store information about which polygons are neighbours to each other. This allows us to reason about the whole walkable area.</p>
<p><img src="/uploads/NavMeshUnderstandingPath.png" alt="寻路"></p>
<p>要查找场景中两个位置之间的路径，我们首先需要将起始位置和目标位置映射到最近的多边形。 然后我们从开始位置开始搜索，访问所有邻居，直到到达目的地多边形。 跟踪访问的多边形允许我们找到从开始到目的地的多边形序列。 寻找路径的常见算法是Unity <em>使用的A </em>（发音为“A star”）。</p>
<p>To find path between two locations in the scene, we first need to map the start and destination locations to their nearest polygons. Then we start searching from the start location, visiting all the neighbours until we reach the destination polygon. Tracing the visited polygons allows us to find the sequence of polygons which will lead from the start to the destination. A common algorithm to find the path is A* (pronounced “A star”), which is what Unity uses.</p>
<p><img src="/uploads/NavMeshUnderstandingCorridor.png" alt="跟随路径"></p>
<p>描述从开始到目的地多边形路径的多边形序列称为走廊。 Agent将通过总是转向走廊的下一个可见角落而到达目的地。 如果你有一个简单的游戏，只有一个Agent在场景中移动，那么一次性找到走廊的所有角落并使角色沿连接角的线段移动是很好的。</p>
<p>The sequence of polygons which describe the path from the start to the destination polygon is called a corridor. The agent will reach the destination by always steering towards the next visible corner of the corridor. If you have a simple game where only one agent moves in the scene, it is fine to find all the corners of the corridor in one swoop and animate the character to move along the line segments connecting the corners.</p>
<p>在处理同时移动的多个Agent时，他们需要在避开对方时偏离原来的路径。 尝试使用由线段组成的路径来纠正这种偏差变得非常困难且容易出错。</p>
<p>When dealing with multiple agents moving at the same time, they will need to deviate from the original path when avoiding each other. Trying to correct such deviations using a path consisting of line segments soon becomes very difficult and error prone.</p>
<p><img src="/uploads/NavMeshUnderstandingMove.png" alt="Navmesh理解移动方式"></p>
<p>由于每个框架内的Agent移动都很小，所以我们可以利用多边形的连通性来固定走廊，我们需要绕行。 然后我们很快找到下一个可见的角落转向。<br>Since the agent movement in each frame is quite small, we can use the connectivity of the polygons to fix up the corridor in case we need to take a little detour. Then we quickly find the next visible corner to steer towards.</p>
<h1 id="Avoiding-Obstacles-规避障碍"><a href="#Avoiding-Obstacles-规避障碍" class="headerlink" title="Avoiding Obstacles / 规避障碍"></a>Avoiding Obstacles / 规避障碍</h1><p><img src="/uploads/NavMeshUnderstandingAvoid.png" alt="NavMesh理解规避"></p>
<p>转向逻辑取下一个角的位置，并根据这个数字找出到达目的地所需的方向和速度（或速度）。 使用所需的速度移动Agent可能会导致与其他Agent发生冲突。</p>
<p>The steering logic takes the position of the next corner and based on that figures out a desired direction and speed (or velocity) needed to reach the destination. Using the desired velocity to move the agent can lead to collision with other agents.</p>
<p>障碍规避选择新的速度，该速度在向期望的方向移动和防止将来与其他Agent和导航网格的边缘的碰撞之间平衡。 Unity使用交互的度障碍（RVO）来预测和防止碰撞。<br>Obstacle avoidance chooses a new velocity which balances between moving in the desired direction and preventing future collisions with other agents and edges of the navigation mesh. Unity is using reciprocal velocity obstacles (RVO) to predict and prevent collisions.</p>
<h1 id="Moving-the-Agent-移动Agent"><a href="#Moving-the-Agent-移动Agent" class="headerlink" title="Moving the Agent / 移动Agent"></a>Moving the Agent / 移动Agent</h1><p>最后在转向和避障后计算最终速度。 在Unity中，Agent使用简单的动态模型进行模拟，该模型还考虑了加速度，以便更自然，更流畅地移动。<br>Finally after steering and obstacle avoidance the final velocity is calculated. In Unity the agents are simulated using a simple dynamic model, which also takes into account acceleration to allow more natural and smooth movement.</p>
<p>在这个阶段，可以将模拟Agent的速度提供给Mecanim动画系统，以移动角色，或者让导航系统处理。<br>At this stage it is possible to feed the velocity from the simulated agent to the Mecanim animation system to move the character, or let the navigation system take care of that.</p>
<p>一旦使用任一方法移动Agent，模拟的Agent位置将被移动，并被限制在NavMesh内。 这最后一小步对于强大的导航非常重要。<br>Once the agent has been moved using either method, the simulated agent location is moved and constrained to NavMesh. This last small step is important for robust navigation.</p>
<h1 id="Global-and-Local"><a href="#Global-and-Local" class="headerlink" title="Global and Local"></a>Global and Local</h1><p><img src="/uploads/NavMeshUnderstandingLoop.png" alt="理解Navmesh的循环"></p>
<p>关于导航最重要的事情之一是全局导航和本地导航之间的区别。</p>
<p>One of the most important things to understand about navigation is the difference between global and local navigation.</p>
<p>全局导航是用来查找全局各地的走廊。 在全局范围内寻找路径是一项代价高昂的操作，需要相当多的处理能力和内存。</p>
<p>Global navigation is used to find the corridor across the world. Finding a path across the world is a costly operation requiring quite a lot of processing power and memory.</p>
<p>描述路径的多边形的线性列表是用于转向的灵活的数据结构，并且可以随着Agent的位置移动而在本地调整。 本地(Local)导航试图找出如何有效地移动到下一个角落，而不会与其他Agent或移动对象发生冲突。</p>
<p>The linear list of polygons describing the path is a flexible data structure for steering, and it can be locally adjusted as the agent’s position moves. Local navigation tries to figure out how to efficiently move towards the next corner without colliding with other agents or moving objects.</p>
<h1 id="Two-Cases-for-Obstacles-两个障碍案例"><a href="#Two-Cases-for-Obstacles-两个障碍案例" class="headerlink" title="Two Cases for Obstacles / 两个障碍案例"></a>Two Cases for Obstacles / 两个障碍案例</h1><p>导航的许多应用需要其他类型的障碍，而不仅仅是其他Agent。 这些可能是射击游戏或车辆中常见的箱子和桶。 障碍物可以通过局部避障或全局寻路来处理。</p>
<p>Many applications of navigation require other types of obstacles rather than just other agents. These could be the usual crates and barrels in a shooter game, or vehicles. The obstacles can be handled using local obstacle avoidance or global pathfinding.</p>
<p>当障碍物移动时，最好使用避免局部障碍物来处理。 这样Agent可以预测性地避免障碍。 当障碍物静止时，可以考虑阻挡所有Agent人的路径，障碍物应该影响全局导航，即导航网格。</p>
<p>When an obstacle is moving, it is best handled using local obstacles avoidance. This way the agent can predictively avoid the obstacle. When the obstacle becomes stationary, and can be considered to block the path of all agents, the obstacles should affect the global navigation, that is, the navigation mesh.</p>
<p>改变NavMesh被称为雕刻(carving)。 该过程检测障碍物的哪些部分接触NavMesh并将孔雕刻到NavMesh中。 这在计算上是昂贵的操作，这又是另一个令人信服的原因，为什么移动障碍物应该使用避免碰撞来处理。</p>
<p>Changing the NavMesh is called carving. The process detects which parts of the obstacle touches the NavMesh and carves holes into the NavMesh. This is computationally expensive operation, which is yet another compelling reason, why moving obstacles should be handled using collision avoidance.</p>
<h1 id="Describing-Off-mesh-Links-关于Off-mesh（跨网格链接）"><a href="#Describing-Off-mesh-Links-关于Off-mesh（跨网格链接）" class="headerlink" title="Describing Off-mesh Links / 关于Off-mesh（跨网格链接）"></a>Describing Off-mesh Links / 关于Off-mesh（跨网格链接）</h1><p><img src="/uploadsNavMeshUnderstandingOffmesh.png" alt="理解offmesh"></p>
<p>NavMesh多边形之间的连接使用路径查找系统内的链接进行描述。 有时需要让Agent人跨越不可行走的地方，例如跳过围栏或穿过关闭的门。 这些案件需要知道行动的地点。</p>
<p>The connections between the NavMesh polygons are described using links inside the pathfinding system. Sometimes it is necessary to let the agent to navigate across places which are not walkable, for example, jumping over a fence, or traversing through a closed door. These cases need to know the location of the action.</p>
<p>这些动作可以使用Off-Mesh链接进行注释，通过指定的链接告诉探路者路线存在。 这个链接可以在路径后面访问，并且可以执行特殊的动作。</p>
<p>These actions can be annotated using Off-Mesh Links which tell the pathfinder that a route exists through the specified link. This link can be later accessed when following the path, and the special action can be executed.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;时间仓促，大部分采用google机器翻译来不及全部校对翻译成中文资料 本篇作为笔记。感兴趣的可以看下。这篇是记录Unity3D寻路的官方文档阅读体验。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The Navigation System allows you to create characters which can navigate the game world. It gives your characters the ability to understand that they need to take stairs to reach second floor, or to jump to get over a ditch. The Unity NavMesh system consists of the following pieces:&lt;/p&gt;
&lt;p&gt;Unity3d的寻路系统大概有下面几个部分：&lt;/p&gt;
&lt;p&gt;NavMesh（导航网格的缩写）是描述游戏世界的步行表面的数据结构，并且允许从游戏世界中的一个步行位置到另一个步行路径找到路径。 数据结构是烘焙的网格里获取的。&lt;/p&gt;
&lt;p&gt;NavMesh (short for Navigation Mesh) is a data structure which describes the walkable surfaces of the game world and allows to find path from one walkable location to another in the game world. The data structure is built, or baked, automatically from your level geometry.&lt;/p&gt;
&lt;p&gt;NavMesh Agent组件帮助您创建角色，在向目标移动时避开彼此。Agent使用NavMesh理解游戏世界，他们知道如何避免彼此以及移动障碍物。&lt;br&gt;离网链接组件允许您合并无法使用可走行的曲面表示的导航快捷方式。 例如，跳过沟渠或栅栏，或者在走过它之前打开门，都可以被描述为“Off-mesh”链接。&lt;/p&gt;
&lt;p&gt;NavMesh Agent component help you to create characters which avoid each other while moving towards their goal. Agents reason about the game world using the NavMesh and they know how to avoid each other as well as moving obstacles.&lt;br&gt;Off-Mesh Link component allows you to incorporate navigation shortcuts which cannot be represented using a walkable surface. For example, jumping over a ditch or a fence, or opening a door before walking through it, can be all described as Off-mesh links.&lt;/p&gt;
&lt;p&gt;NavMesh障碍组件允许您描述Agent在航行世界时应避免的移动障碍。 物理系统控制的一个桶或一个箱子是一个障碍的好例子。 当障碍物移动时，障碍物尽力避开它，但是一旦障碍物变得静止，它将在导航网上挖一个洞，使得障碍物可以改变它们的路径来绕过障碍物，或者如果障碍物妨碍路径 方式，Agent可以找到不同的路线。&lt;/p&gt;
&lt;p&gt;NavMesh Obstacle component allows you to describe moving obstacles the agents should avoid while navigating the world. A barrel or a crate controlled by the physics system is a good example of an obstacle. While the obstacle is moving the agents do their best to avoid it, but once the obstacle becomes stationary it will carve a hole in the navmesh so that the agents can change their paths to steer around it, or if the stationary obstacle is blocking the path way, the agents can find a different route.&lt;/p&gt;
    
    </summary>
    
      <category term="UNITY3D" scheme="http://vrast.cn/categories/UNITY3D/"/>
    
    
      <category term="Navigation" scheme="http://vrast.cn/tags/Navigation/"/>
    
  </entry>
  
  <entry>
    <title>Unity3D 自动化测试</title>
    <link href="http://vrast.cn/posts/1d932b40/"/>
    <id>http://vrast.cn/posts/1d932b40/</id>
    <published>2017-12-05T16:33:39.000Z</published>
    <updated>2017-12-05T17:09:15.206Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>今天凌晨开始写这篇文章，想写这个主题很久了。相信每个资深开发都经历过每次公司要发版本之前都会有一堆bug闪现。真让人苦恼。很高兴 Unity technology 于 今年的六一儿童节更新了自动化测试的特性。这下终于不用再导入第三方自动化测试插件了。当然本章节会相对完整的快速概述其重要部分。如果你还想知道更多, Unity3D 已经提供了比较完善的<a href="https://docs.unity3d.com/Manual/testing-editortestsrunner.html" target="_blank" rel="external">文档</a>。</p>
</blockquote>
<a id="more"></a>
<h1 id="适用于多种平台的自动化测试"><a href="#适用于多种平台的自动化测试" class="headerlink" title="适用于多种平台的自动化测试"></a>适用于多种平台的自动化测试</h1><p>TestRunner 适用于 Standalone, Android, or iOS 等平台。你可以在 Window &gt; Test Runner 找到此项功能。</p>
<p>TestRunner 使用了Unity一体化的单元测试库。开源的.net语言库。更多的信息在 <a href="http://nunit.org" target="_blank" rel="external">nunit 官网</a> 和 <a href="https://github.com/nunit/docs/wiki/NUnit-Documentation" target="_blank" rel="external">NUnit GitHub文档</a>.</p>
<p>UnityTestAttribute是Unity Test Runner的标准NUnit库的主要补充。 这是一种单元测试，允许您从测试中跳过框架（允许后台任务完成）。 当以编辑模式运行时，以Play模式运行并在EditorApplication.update回调循环中执行UnityTestAttribute作为协同程序。</p>
<h1 id="已知问题和限制"><a href="#已知问题和限制" class="headerlink" title="已知问题和限制"></a>已知问题和限制</h1><p>以下是Unity Test Runner的已知问题和局限性：</p>
<p>WebGL和WSA平台不支持UnityTestAttribute。<br>测试运行者目前不支持AOT平台。<br>UnityTest不支持参数化测试（ValueSource除外）。<br>在命令行运行的平台播放器（例如Standalone，Android或iOS）中的自动测试目前不受支持。<br>在进行EditMode测试时，您必须创建一个文件夹名称编辑器来存储它们。</p>
<p><img src="/uploads/TestRunner3.png" alt="面板参数"></p>
<p><img src="/uploads/TestRunner5.png" alt="开启与关闭测试"></p>
<h1 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h1><h2 id="Test-与-UnityTest-特性"><a href="#Test-与-UnityTest-特性" class="headerlink" title="Test 与 UnityTest 特性"></a>Test 与 UnityTest 特性</h2><p>在编辑器或者运行状态下都可以使用Test<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[Test]</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GameObject_CreatedWithGiven_WillHaveTheName</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> go = <span class="keyword">new</span> GameObject(<span class="string">"MyGameObject"</span>);</div><div class="line">    Assert.AreEqual(“MyGameObject”, go.name);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在运行状态下使用UnityTest<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[UnityTest]</div><div class="line"><span class="function"><span class="keyword">public</span> IEnumerator <span class="title">GameObject_WithRigidBody_WillBeAffectedByPhysics</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> go = <span class="keyword">new</span> GameObject();</div><div class="line">    go.AddComponent&lt;Rigidbody&gt;();</div><div class="line">    <span class="keyword">var</span> originalPosition = go.transform.position.y;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForFixedUpdate</span>(<span class="params"></span>)</span>;</div><div class="line"></div><div class="line">    Assert.AreNotEqual(originalPosition, go.transform.position.y);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在编辑器下使用<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[UnityTest]</div><div class="line"><span class="function"><span class="keyword">public</span> IEnumerator <span class="title">EditorUtility_WhenExecuted_ReturnsSuccess</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> utility = RunEditorUtilityInTheBackgroud();</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (utility.isRunning)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Assert.IsTrue(utility.isSuccess);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="UnityPlatform-特性"><a href="#UnityPlatform-特性" class="headerlink" title="UnityPlatform 特性"></a>UnityPlatform 特性</h2><p>该特性可以帮助你区分测试的平台<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[Test]</div><div class="line">[UnityPlatform (RuntimePlatform.WindowsPlayer)]</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestMethod1</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">   Assert.AreEqual(Application.platform, RuntimePlatform.WindowsPlayer);</div><div class="line">&#125;</div><div class="line"></div><div class="line">[Test]</div><div class="line">[UnityPlatform(exclude = <span class="keyword">new</span>[] &#123;RuntimePlatform.WindowsEditor &#125;)]</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestMethod2</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">   Assert.AreNotEqual(Application.platform, RuntimePlatform.WindowsEditor);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="PrebuildSetup"><a href="#PrebuildSetup" class="headerlink" title="PrebuildSetup"></a>PrebuildSetup</h2><p>如果您需要在测试开始之前执行任何额外的设置，请使用PrebuildSetupAttribute。 为此，请指定实现IPrebuildSetup接口的类类型。 如果您需要运行整个类的设置代码（例如，如果您想在测试开始之前执行一些代码，例如特定测试所需的资源准备或设置），请在类中实现IPrebuildSetup接口以进行测试。</p>
<p>只需要继承 IPrebuildSetup 接口 并且 标记 PrebuildSetup 特性就能提前配置单元测试所需数据或者资源。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestsWithPrebuildStep</span> : <span class="title">IPrebuildSetup</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Setup</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Run this code before the tests are executed</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [Test]</div><div class="line">    <span class="comment">//PrebuildSetupAttribute can be skipped because it's implemented in the same class</span></div><div class="line">    [PrebuildSetup(<span class="keyword">typeof</span>(TestsWithPrebuildStep))]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        (...)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在进入播放模式或建立播放器之前，执行PrebuildSetup代码。 安装程序可以使用UnityEditor命名空间及其功能，但为了避免编译错误，您必须将其放置在“editor”文件夹中，或者必须使用#if UNITY_EDITOR指令进行保护。</p>
<h2 id="LogAssert-Log断言"><a href="#LogAssert-Log断言" class="headerlink" title="LogAssert Log断言"></a>LogAssert Log断言</h2><p>如果记录除常规日志或警告消息之外的其他消息，则测试将失败。 使用LogAssert类在日志中预期消息，并防止测试失败。<br>如果预期的消息没有出现，测试也报告失败。 如果任何常规的日志或警告消息不出现，测试也失败。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[Test]</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LogAssertExample</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//Expect a regular log message</span></div><div class="line">    LogAssert.Expect(LogType.Log, <span class="string">"Log message"</span>);</div><div class="line">    <span class="comment">//A log message is expected so without the following line</span></div><div class="line">    <span class="comment">//the test would fail</span></div><div class="line">    Debug.Log(<span class="string">"Log message"</span>);</div><div class="line">    <span class="comment">//An error log is printed</span></div><div class="line">    Debug.LogError(<span class="string">"Error message"</span>);</div><div class="line">    <span class="comment">//Without expecting an error log, the test would fail</span></div><div class="line">    LogAssert.Expect(LogType.Error, <span class="string">"Error message"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="MonoBehaviourTest-Mono脚本测试"><a href="#MonoBehaviourTest-Mono脚本测试" class="headerlink" title="MonoBehaviourTest Mono脚本测试"></a>MonoBehaviourTest Mono脚本测试</h2><p>MonoBehaviourTest是编写MonoBehaviour测试的包装，也是一个协程。 从UnityTest中产生MonoBehaviourTest来实例化指定的MonoBehaviour并等待它完成执行。 实现IMonoBehaviourTest接口来指示测试完成的时间。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[UnityTest]</div><div class="line">public IEnumerator MonoBehaviourTest_Works()</div><div class="line">&#123;</div><div class="line">    yield return new MonoBehaviourTest&lt;MyMonoBehaviourTest&gt;();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class MyMonoBehaviourTest : MonoBehaviour, IMonoBehaviourTest</div><div class="line">&#123;</div><div class="line">    private int frameCount;</div><div class="line">    public bool IsTestFinished</div><div class="line">    &#123;</div><div class="line">        get &#123; return frameCount &gt; 10; &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">     void Update()</div><div class="line">     &#123;</div><div class="line">        frameCount++;</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><ol>
<li>所有标记  UnityTestAttribute  特性的方法 测试的时候就像是协同程序一样被执行。</li>
<li>待续 。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;今天凌晨开始写这篇文章，想写这个主题很久了。相信每个资深开发都经历过每次公司要发版本之前都会有一堆bug闪现。真让人苦恼。很高兴 Unity technology 于 今年的六一儿童节更新了自动化测试的特性。这下终于不用再导入第三方自动化测试插件了。当然本章节会相对完整的快速概述其重要部分。如果你还想知道更多, Unity3D 已经提供了比较完善的&lt;a href=&quot;https://docs.unity3d.com/Manual/testing-editortestsrunner.html&quot;&gt;文档&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="UNITY3D" scheme="http://vrast.cn/categories/UNITY3D/"/>
    
    
      <category term="测试自动化" scheme="http://vrast.cn/tags/%E6%B5%8B%E8%AF%95%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Git FAQ</title>
    <link href="http://vrast.cn/posts/1e42cd7e/"/>
    <id>http://vrast.cn/posts/1e42cd7e/</id>
    <published>2017-12-02T12:37:23.000Z</published>
    <updated>2017-12-03T02:19:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>今天有朋友问了我三个问题：</p>
<ul>
<li>策划或者美术可能没有commit前先pull的习惯，先commit上去，然后push不上。Git提醒pull，然后报错，一般除了程序，甚至没使用过Git的程序就有点不知所措了。应该要讲下出错时候要stash的问题。</li>
<li>策划pull出错时候， 万一revert，然后push强推,把之前别人提交的东西冲掉了。我们有用过回滚，然后强推上去。可以再讲下怎么强推</li>
<li>怎么stash，怎么stash apply，apply失败后怎么弄。commit的顺序最好也要重点强调下</li>
</ul>
<p>在篇中我会解答，如果还有其他问题 请给我留言，我会追加叙述。求关注 求转发。把爱传出去 笑～</p>
<a id="more"></a>
<h1 id="在解答第一个问题之前我们先了解一下什么是-stash-存储-非程序人员跳过此条说明"><a href="#在解答第一个问题之前我们先了解一下什么是-stash-存储-非程序人员跳过此条说明" class="headerlink" title="在解答第一个问题之前我们先了解一下什么是 stash (存储) (非程序人员跳过此条说明)"></a>在解答第一个问题之前我们先了解一下什么是 stash (存储) (非程序人员跳过此条说明)</h1><p><a href="https://stackoverflow.com/questions/10959928/what-does-commit-your-changes-or-stash-them-mean#10959956" target="_blank" rel="external">What does “commit your changes or stash them” mean?</a></p>
<p>stash意味着你有未提交的更改，将会在拉取代码的时候防止本地的修改被覆盖。顺便说一句如果你想知道更多关于Git stash 的问题只需要提问：how do I solve the problem where Git tells me to commit or stash (如何解决Git告诉我commit或stash的问题)</p>
<p>通过git stash将工作区恢复到上次提交的内容，同时备份本地所做的修改，之后就可以正常git pull了，git pull完成后，执行git stash pop将之前本地做的修改应用到当前工作区。</p>
<p>git stash: 备份当前的工作区的内容，从最近的一次提交中读取相关内容，让工作区保证和上次提交的内容一致。同时，将当前的工作区内容保存到Git栈中。<br>git stash pop: 从Git栈中读取最近一次保存的内容，恢复工作区的相关内容。由于可能存在多个Stash的内容，所以用栈来管理，pop会从最近的一个stash中读取内容并恢复。<br>git stash list: 显示Git栈内的所有备份，可以利用这个列表来决定从那个地方恢复。<br>git stash clear: 清空Git栈。此时使用gitg等图形化工具会发现，原来stash的哪些节点都消失了。</p>
<h1 id="Pull-与-Fetch-区别-基本概念"><a href="#Pull-与-Fetch-区别-基本概念" class="headerlink" title="Pull 与 Fetch 区别 (基本概念)"></a>Pull 与 Fetch 区别 (基本概念)</h1><ol>
<li>每次commit都会有一个记录。</li>
<li>本地的所有commit在没有push之前，都是存在本地。别人是更新不到你的commit记录的。</li>
<li>所谓更新就是拿到别人的Commit数据。</li>
<li>如果你更新到别人的commit里也有你本次commit修改的数据 就会产生冲突，就需要合并。</li>
<li>Pull 的意思是 下载比自己更新的commit数据，并且开始合并，可能马上就有从冲突文件。</li>
<li>Fetch 的意思是 下载比自己更新的commit数据，放在那里(不合并到当前commit)，可以看看是否有必要更新到最近commit。</li>
</ol>
<h1 id="先解释下报错信息"><a href="#先解释下报错信息" class="headerlink" title="先解释下报错信息"></a>先解释下报错信息</h1><p>你本地的修改和Git存储上的冲突了，现在有两种方式来解决：</p>
<ol>
<li>commit 先提交本地的修改，commit的原因是为了可追溯，通过本地branches就能拿到N+1个版本的修改。防止丢失</li>
<li>stash 备份本地的修改 ，仍旧是防止丢失，且可以有多个版本 很灵活</li>
</ol>
<h2 id="演示-Stash如何使用-规避文件修改被冲掉"><a href="#演示-Stash如何使用-规避文件修改被冲掉" class="headerlink" title="演示-Stash如何使用 规避文件修改被冲掉"></a>演示-Stash如何使用 规避文件修改被冲掉</h2><p>我们假设有两个人正在操作同一份文件 <code>README.md</code> 。<br>A君 : 我已经提交此文件的修改了，你更新下。<br>B君 : 我先Fetch看看有，然后我上传。嗯？冲突了。我并不知道你修改了什么个文件,我也不想在同步的时候把本地的修改冲掉。 那我提前 <code>Stash</code> 这些个文件吧。</p>
<p><img src="/uploads/gulpfile.png" alt="机制的B君做了如下操作"><br><img src="/uploads/QQ20171202-213806@2x.png" alt="Stash了勾选后的将本地修改在这里"></p>
<p>B君 : 点击<apply stash=""> 可将指定的Stash文件与更新后的文件合并。</apply></p>
<blockquote>
<h2>Stash 简单理解就是备份本地修改,且可以备份多次。什么?又冲突了？用Stash啊！</h2>


</blockquote>
<h2 id="演示-使用commit来规避文件修改被冲掉"><a href="#演示-使用commit来规避文件修改被冲掉" class="headerlink" title="演示-使用commit来规避文件修改被冲掉"></a>演示-使用commit来规避文件修改被冲掉</h2><p>我们假设有两个人正在操作同一份文件 <code>README.md</code> 。<br>A君 : 我已经提交此文件的修改了，你更新下。<br>B君 : 我先Fetch看看有，然后我上传。嗯？冲突了。我并不知道你修改了什么个文件,我也不想在同步的时候把本地的修改冲掉。 那我提前 <code>commit</code> 这些个文件吧。</p>
<p><img src="/uploads/1040FC64-815A-4DD3-B703-52AD31B022D0.png" alt="这个Push Change不用勾选，反正勾选也上传不了但是不影响commit。"><br><img src="/uploads/A2A598E1-86FF-4380-A3CE-FFE532E83E0D.png" alt="现在pull也可以合并本地文件"></p>
<blockquote>
<h2>commit 简单理解就是保存本次修改,且可以被追溯。什么你只会Stash？直接commit也行啊！</h2>




</blockquote>
<h1 id="如何强推？"><a href="#如何强推？" class="headerlink" title="如何强推？"></a>如何强推？</h1><p>理解了上面的之后。发现 用Stash 或者Commit都可以实现强推。</p>
<p><img src="/uploads/BDCE2D9F-7600-48C7-9528-1FFCC155445C.png" alt="现在commit肯定不行 因为被修改过了，sourcetree的机制是 点击按钮 默认commit，然后push"></p>
<p><img src="/uploads/QQ20171202-223641.png" alt="必然是失败的，点击OK,现在本地branch已经有了此次commit痕迹了(可追溯)"></p>
<p>现在点击pull/或者Apply Stash 处理好，上传吧。</p>
<h1 id="出了莫名其妙的问题如何补救？"><a href="#出了莫名其妙的问题如何补救？" class="headerlink" title="出了莫名其妙的问题如何补救？"></a>出了莫名其妙的问题如何补救？</h1><p>有些朋友一看到一堆报错和本地紊乱的修改就慌了。别怕 可以直接回到存档(commit)点去复活。</p>
<p><img src="/uploads/A56FB26C-1A89-4106-BC16-9D41A9114255.png" alt="直接回到某个commit的状态"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天有朋友问了我三个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;策划或者美术可能没有commit前先pull的习惯，先commit上去，然后push不上。Git提醒pull，然后报错，一般除了程序，甚至没使用过Git的程序就有点不知所措了。应该要讲下出错时候要stash的问题。&lt;/li&gt;
&lt;li&gt;策划pull出错时候， 万一revert，然后push强推,把之前别人提交的东西冲掉了。我们有用过回滚，然后强推上去。可以再讲下怎么强推&lt;/li&gt;
&lt;li&gt;怎么stash，怎么stash apply，apply失败后怎么弄。commit的顺序最好也要重点强调下&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在篇中我会解答，如果还有其他问题 请给我留言，我会追加叙述。求关注 求转发。把爱传出去 笑～&lt;/p&gt;
    
    </summary>
    
      <category term="FAQ" scheme="http://vrast.cn/categories/FAQ/"/>
    
    
      <category term="Git" scheme="http://vrast.cn/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Rounded Cube 5</title>
    <link href="http://vrast.cn/posts/710804c5/"/>
    <id>http://vrast.cn/posts/710804c5/</id>
    <published>2017-11-25T15:59:47.000Z</published>
    <updated>2017-11-25T16:08:32.204Z</updated>
    
    <content type="html"><![CDATA[<p>接上回 Rounded Cube 4.本章主题如下:</p>
<ul>
<li>Combine primitive colliders. 合并原始网格</li>
</ul>
<p>此为本人阅读笔记不作为转载处理,详细还请参看原文. <a href="http://catlikecoding.com/unity/tutorials/" target="_blank" rel="external">原文地址</a><br><a id="more"></a></p>
<p>圆滑的立方体碰撞并不是圆滑的，所以就有了本章节来解决这个问题。添加如下方法：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Generate</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    GetComponent&lt;MeshFilter&gt;().mesh = mesh = <span class="keyword">new</span> Mesh();</div><div class="line">    mesh.name = <span class="string">"Procedural Cube"</span>;</div><div class="line">    CreateVertices();</div><div class="line">    CreateTriangles();</div><div class="line">    CreateColliders();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateColliders</span> (<span class="params"></span>) </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第一步添加一个cube碰撞器<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateColliders</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		gameObject.AddComponent&lt;BoxCollider&gt;();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="/uploads/07-one-collider.png" alt="单个盒子碰撞器"></p>
<p>事实证明，Unity足够智能的定位和缩放碰撞器，使其与我们网格的边界框匹配。 现在，我们必须缩放碰撞器，使其与两个相对面的平坦侧面相匹配。 由于这三个面对都需要完成，我们最终得到三个相交的块。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateColliders</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		AddBoxCollider(xSize, ySize - roundness * <span class="number">2</span>, zSize - roundness * <span class="number">2</span>);</div><div class="line">		AddBoxCollider(xSize - roundness * <span class="number">2</span>, ySize, zSize - roundness * <span class="number">2</span>);</div><div class="line">		AddBoxCollider(xSize - roundness * <span class="number">2</span>, ySize - roundness * <span class="number">2</span>, zSize);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddBoxCollider</span> (<span class="params"><span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">float</span> z</span>) </span>&#123;</div><div class="line">		BoxCollider c = gameObject.AddComponent&lt;BoxCollider&gt;();</div><div class="line">		c.size = <span class="keyword">new</span> Vector3(x, y, z);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/07-box-colliders.png" alt="平坦区域的盒子碰撞"></p>
<p>我们可以用胶囊来填充棱角。我们需要给他们正确的方向，把他们定位在每一个边缘的中心。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddCapsuleCollider</span> (<span class="params"><span class="keyword">int</span> direction, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">float</span> z</span>) </span>&#123;</div><div class="line">		CapsuleCollider c = gameObject.AddComponent&lt;CapsuleCollider&gt;();</div><div class="line">		c.center = <span class="keyword">new</span> Vector3(x, y, z);</div><div class="line">		c.direction = direction;</div><div class="line">		c.radius = roundness;</div><div class="line">		c.height = c.center[direction] * <span class="number">2</span>f;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>我们每边需要一个胶囊，总共有十二个胶囊。 我创建了最小，最大和最大的矢量，以使放置更容易。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateColliders</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		AddBoxCollider(xSize, ySize - roundness * <span class="number">2</span>, zSize - roundness * <span class="number">2</span>);</div><div class="line">		AddBoxCollider(xSize - roundness * <span class="number">2</span>, ySize, zSize - roundness * <span class="number">2</span>);</div><div class="line">		AddBoxCollider(xSize - roundness * <span class="number">2</span>, ySize - roundness * <span class="number">2</span>, zSize);</div><div class="line"></div><div class="line">		Vector3 min = Vector3.one * roundness;</div><div class="line">		Vector3 half = <span class="keyword">new</span> Vector3(xSize, ySize, zSize) * <span class="number">0.5</span>f; </div><div class="line">		Vector3 max = <span class="keyword">new</span> Vector3(xSize, ySize, zSize) - min;</div><div class="line"></div><div class="line">		AddCapsuleCollider(<span class="number">0</span>, half.x, min.y, min.z);</div><div class="line">		AddCapsuleCollider(<span class="number">0</span>, half.x, min.y, max.z);</div><div class="line">		AddCapsuleCollider(<span class="number">0</span>, half.x, max.y, min.z);</div><div class="line">		AddCapsuleCollider(<span class="number">0</span>, half.x, max.y, max.z);</div><div class="line">		</div><div class="line">		AddCapsuleCollider(<span class="number">1</span>, min.x, half.y, min.z);</div><div class="line">		AddCapsuleCollider(<span class="number">1</span>, min.x, half.y, max.z);</div><div class="line">		AddCapsuleCollider(<span class="number">1</span>, max.x, half.y, min.z);</div><div class="line">		AddCapsuleCollider(<span class="number">1</span>, max.x, half.y, max.z);</div><div class="line">		</div><div class="line">		AddCapsuleCollider(<span class="number">2</span>, min.x, min.y, half.z);</div><div class="line">		AddCapsuleCollider(<span class="number">2</span>, min.x, max.y, half.z);</div><div class="line">		AddCapsuleCollider(<span class="number">2</span>, max.x, min.y, half.z);</div><div class="line">		AddCapsuleCollider(<span class="number">2</span>, max.x, max.y, half.z);</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/07-all-colliders.png" alt="为接下来的动作做准备"></p>
<p>剩下要做的就是在圆角立方体上加一个刚体，恭喜你，看完了本章教程。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接上回 Rounded Cube 4.本章主题如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Combine primitive colliders. 合并原始网格&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此为本人阅读笔记不作为转载处理,详细还请参看原文. &lt;a href=&quot;http://catlikecoding.com/unity/tutorials/&quot;&gt;原文地址&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="翻译" scheme="http://vrast.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="UNITY3D" scheme="http://vrast.cn/tags/UNITY3D/"/>
    
  </entry>
  
  <entry>
    <title>Rounded Cube 4</title>
    <link href="http://vrast.cn/posts/60f3453/"/>
    <id>http://vrast.cn/posts/60f3453/</id>
    <published>2017-11-25T15:13:25.000Z</published>
    <updated>2017-11-25T16:09:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>接上回 Rounded Cube 3.本章主题如下:</p>
<ul>
<li>Create a custom shader. 使用自定义shader</li>
</ul>
<p>此为本人阅读笔记不作为转载处理,详细还请参看原文. <a href="http://catlikecoding.com/unity/tutorials/" target="_blank" rel="external">原文地址</a><br><a id="more"></a></p>
<p>虽然我们现在可以区分面，但我们仍然没有纹理坐标。 假设我们想在整个立方体上显示一个网格模式，以便我们可以看到单个四边形。 我们怎样才能做到这一点？</p>
<p><img src="/uploads/06-grid-texture.png" alt="贴图(纹理)覆盖四边形"></p>
<p>我们可以使用自定义着色器来找出如何应用纹理，而不是将UV坐标存储在网格中。 这是一个刚创建的着色器。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">Shader <span class="string">"Custom/Rounded Cube Grid"</span> &#123;</div><div class="line">	Properties &#123;</div><div class="line">		_Color (<span class="string">"Color"</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">		_MainTex (<span class="string">"Albedo (RGB)"</span>, <span class="number">2</span>D) = <span class="string">"white"</span> &#123;&#125;</div><div class="line">		_Glossiness (<span class="string">"Smoothness"</span>, Range(<span class="number">0</span>,<span class="number">1</span>)) = <span class="number">0.5</span></div><div class="line">		_Metallic (<span class="string">"Metallic"</span>, Range(<span class="number">0</span>,<span class="number">1</span>)) = <span class="number">0.0</span></div><div class="line">	&#125;</div><div class="line">	SubShader &#123;</div><div class="line">		Tags &#123; <span class="string">"RenderType"</span>=<span class="string">"Opaque"</span> &#125;</div><div class="line">		LOD <span class="number">200</span></div><div class="line">		</div><div class="line">		CGPROGRAM</div><div class="line">		<span class="meta">#<span class="meta-keyword">pragma</span> surface surf Standard fullforwardshadows</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">pragma</span> target 3.0</span></div><div class="line"></div><div class="line">		sampler2D _MainTex;</div><div class="line"></div><div class="line">		<span class="keyword">struct</span> Input &#123;</div><div class="line">			float2 uv_MainTex;</div><div class="line">		&#125;;</div><div class="line"></div><div class="line">		half _Glossiness;</div><div class="line">		half _Metallic;</div><div class="line">		fixed4 _Color;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutputStandard o</span>) </span>&#123;</div><div class="line">			fixed4 c = tex2D(_MainTex, IN.uv_MainTex) * _Color;</div><div class="line">			o.Albedo = c.rgb;</div><div class="line">			o.Metallic = _Metallic;</div><div class="line">			o.Smoothness = _Glossiness;</div><div class="line">			o.Alpha = c.a;</div><div class="line">		&#125;</div><div class="line">		ENDCG</div><div class="line">	&#125; </div><div class="line">	FallBack <span class="string">"Diffuse"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是默认的表面着色器。 重要的是它定义了一个输入结构，它要求主纹理的坐标。 这些坐标在surf函数中使用，为每个渲染片段调用。 由于我们没有这样的坐标，我们必须用其他的东西替换uv_MainTex。– Google这段翻译的真好</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Input &#123;</div><div class="line">        float2 cubeUV;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    …</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutputStandard o</span>) </span>&#123;</div><div class="line">        fixed4 c = tex2D(_MainTex, IN.cubeUV) * _Color;</div><div class="line">        o.Albedo = c.rgb;</div><div class="line">        o.Metallic = _Metallic;</div><div class="line">        o.Smoothness = _Glossiness;</div><div class="line">        o.Alpha = c.a;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于每个顶点定义了UV，所以我们必须添加一个每个顶点调用的函数。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">CGPROGRAM</div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> surface surf Standard fullforwardshadows vertex:vert</span></div><div class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> target 3.0</span></div><div class="line"></div><div class="line">    sampler2D _MainTex;</div><div class="line"></div><div class="line">    <span class="keyword">struct</span> Input &#123;</div><div class="line">        float2 cubeUV;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    half _Glossiness;</div><div class="line">    half _Metallic;</div><div class="line">    fixed4 _Color;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">vert</span> (<span class="params">inout appdata_full v, <span class="keyword">out</span> Input o</span>) </span>&#123;</div><div class="line">        UNITY_INITIALIZE_OUTPUT(Input, o);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutputStandard o</span>) </span>&#123;</div><div class="line">        fixed4 c = tex2D(_MainTex, IN.cubeUV) * _Color;</div><div class="line">        o.Albedo = c.rgb;</div><div class="line">        o.Metallic = _Metallic;</div><div class="line">        o.Smoothness = _Glossiness;</div><div class="line">        o.Alpha = c.a;</div><div class="line">    &#125;</div><div class="line">ENDCG</div></pre></td></tr></table></figure>
<p>为了检查我们的着色器是否工作，直接使用顶点位置的XY坐标作为UV。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">vert</span> (<span class="params">inout appdata_full v, <span class="keyword">out</span> Input o</span>) </span>&#123;</div><div class="line">        UNITY_INITIALIZE_OUTPUT(Input, o);</div><div class="line">        o.cubeUV = v.vertex.xy;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/06-grid-xy.png" alt="使用xy作为UV"><br><img src="/uploads/06-material-x.png" alt="使用xy作为UV"></p>
<p>这对于Z面来说是合理的，但其他的却是一团糟。 我们需要为它们使用不同的顶点坐标。 所以我们有一个选择，我们可以通过添加关键字枚举着色器属性来支持。</p>
<blockquote>
<p>这里划重点了 使用关键枚举来决定渲染不同的面，背后的工作原理是：枚举对应的宏定义</p>
</blockquote>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Properties &#123;</div><div class="line">    _Color (<span class="string">"Color"</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">    _MainTex (<span class="string">"Albedo (RGB)"</span>, <span class="number">2</span>D) = <span class="string">"white"</span> &#123;&#125;</div><div class="line">    _Glossiness (<span class="string">"Smoothness"</span>, Range(<span class="number">0</span>,<span class="number">1</span>)) = <span class="number">0.5</span></div><div class="line">    _Metallic (<span class="string">"Metallic"</span>, Range(<span class="number">0</span>,<span class="number">1</span>)) = <span class="number">0.0</span></div><div class="line">    [KeywordEnum(X, Y, Z)] _Faces (<span class="string">"Faces"</span>, Float) = <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以通过定义关键字义，使我们能够为每个选项编写不同的代码。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">vert</span> (<span class="params">inout appdata_full v, <span class="keyword">out</span> Input o</span>) </span>&#123;</div><div class="line">			UNITY_INITIALIZE_OUTPUT(Input, o);</div><div class="line">			<span class="meta">#<span class="meta-keyword">if</span> defined(_FACES_X)</span></div><div class="line">				o.cubeUV = v.vertex.yz;</div><div class="line">			<span class="meta">#<span class="meta-keyword">elif</span> defined(_FACES_Y)</span></div><div class="line">				o.cubeUV = v.vertex.xz;</div><div class="line">			<span class="meta">#<span class="meta-keyword">elif</span> defined(_FACES_Z)</span></div><div class="line">				o.cubeUV = v.vertex.xy;</div><div class="line">			<span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">		&#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/06-grid-faces.png" alt="每种材质使用不同的坐标"></p>
<p>刚开始看起来不错，但网格线不适合实际四边形。 更糟糕的是，当我们使用世界空间顶点位置时，移动或旋转立方体时会变得很奇怪。</p>
<p>在四舍五入之前，我们需要原始立方体的顶点位置。 如果我们可以将它们存储在网格中，我们可以将它们传递给着色器。 由于我们不使用顶点颜色，因此我们可以使用顶点颜色通道来达到此目的。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> Color32[] cubeUV;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateVertices</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">int</span> cornerVertices = <span class="number">8</span>;</div><div class="line">    <span class="keyword">int</span> edgeVertices = (xSize + ySize + zSize - <span class="number">3</span>) * <span class="number">4</span>;</div><div class="line">    <span class="keyword">int</span> faceVertices = (</div><div class="line">        (xSize - <span class="number">1</span>) * (ySize - <span class="number">1</span>) +</div><div class="line">        (xSize - <span class="number">1</span>) * (zSize - <span class="number">1</span>) +</div><div class="line">        (ySize - <span class="number">1</span>) * (zSize - <span class="number">1</span>)) * <span class="number">2</span>;</div><div class="line">    vertices = <span class="keyword">new</span> Vector3[cornerVertices + edgeVertices + faceVertices];</div><div class="line">    normals = <span class="keyword">new</span> Vector3[vertices.Length];</div><div class="line">    cubeUV = <span class="keyword">new</span> Color32[vertices.Length];</div><div class="line"></div><div class="line">    …</div><div class="line"></div><div class="line">    mesh.vertices = vertices;</div><div class="line">    mesh.normals = normals;</div><div class="line">    mesh.colors32 = cubeUV;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetVertex</span> (<span class="params"><span class="keyword">int</span> i, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z</span>) </span>&#123;</div><div class="line">    …</div><div class="line"></div><div class="line">    normals[i] = (vertices[i] - inner).normalized;</div><div class="line">    vertices[i] = inner + normals[i] * roundness;</div><div class="line">    cubeUV[i] = <span class="keyword">new</span> Color32((<span class="keyword">byte</span>)x, (<span class="keyword">byte</span>)y, (<span class="keyword">byte</span>)z, <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里我们必须使用Color32来代替通常的Color类型，因为顶点颜色组件被存储为单个字节。 整个颜色是四个字节，与单个浮点大小相同。</p>
<p>如果我们使用常规颜色，那么Unity将从0-1浮点数转换为0-255字节，截断该范围之外的所有内容。 通过直接转换为字节，我们可以处理多达255的多维数据集，这应该是足够的。</p>
<p>在着色器方面，我们现在可以使用顶点颜色而不是其位置。 当着色器将顶点颜色通道解释为0-1范围内的值时，我们必须通过乘以255来撤消此转换。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">vert</span> (<span class="params">inout appdata_full v, <span class="keyword">out</span> Input o</span>) </span>&#123;</div><div class="line">    UNITY_INITIALIZE_OUTPUT(Input, o);</div><div class="line">    <span class="meta">#<span class="meta-keyword">if</span> defined(_FACES_X)</span></div><div class="line">        o.cubeUV = v.color.yz * <span class="number">255</span>;</div><div class="line">    <span class="meta">#<span class="meta-keyword">elif</span> defined(_FACES_Y)</span></div><div class="line">        o.cubeUV = v.color.xz * <span class="number">255</span>;</div><div class="line">    <span class="meta">#<span class="meta-keyword">elif</span> defined(_FACES_Z)</span></div><div class="line">        o.cubeUV = v.color.xy * <span class="number">255</span>;</div><div class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/06-grid-cube.png" alt="网格使用原始立方体位置"></p>
<p>我们终于有了一个功能性的网格纹理。 请注意，每对面之一的UV坐标是镜像的，但这不是重点，因为我们使用的是对称纹理。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接上回 Rounded Cube 3.本章主题如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a custom shader. 使用自定义shader&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此为本人阅读笔记不作为转载处理,详细还请参看原文. &lt;a href=&quot;http://catlikecoding.com/unity/tutorials/&quot;&gt;原文地址&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="翻译" scheme="http://vrast.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="UNITY3D" scheme="http://vrast.cn/tags/UNITY3D/"/>
    
  </entry>
  
  <entry>
    <title>Rounded Cube 3</title>
    <link href="http://vrast.cn/posts/986ba1f0/"/>
    <id>http://vrast.cn/posts/986ba1f0/</id>
    <published>2017-11-25T14:56:00.000Z</published>
    <updated>2017-11-25T16:08:32.205Z</updated>
    
    <content type="html"><![CDATA[<p>接上回 Rounded Cube 2.本章主题如下:</p>
<ul>
<li>Use sub-meshes. 使用子网格</li>
<li>Create a custom shader. 使用自定义shader</li>
<li>Combine primitive colliders. 合并原始网格</li>
</ul>
<p>此为本人阅读笔记不作为转载处理,详细还请参看原文. <a href="http://catlikecoding.com/unity/tutorials/" target="_blank" rel="external">原文地址</a><br><a id="more"></a></p>
<p>现在我们已经有了一个没有重复顶点的圆滑立方体，现在需要使用多个材质。这时候就需用到子网格。我们把网格分成三对相对的面。 这意味着我们需要三个数组和三个三角形索引。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateTriangles</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">int</span>[] trianglesZ = <span class="keyword">new</span> <span class="keyword">int</span>[(xSize * ySize) * <span class="number">12</span>];</div><div class="line">    <span class="keyword">int</span>[] trianglesX = <span class="keyword">new</span> <span class="keyword">int</span>[(ySize * zSize) * <span class="number">12</span>];</div><div class="line">    <span class="keyword">int</span>[] trianglesY = <span class="keyword">new</span> <span class="keyword">int</span>[(xSize * zSize) * <span class="number">12</span>];</div><div class="line">    <span class="keyword">int</span> ring = (xSize + zSize) * <span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> tZ = <span class="number">0</span>, tX = <span class="number">0</span>, tY = <span class="number">0</span>, v = <span class="number">0</span>;</div><div class="line">    …</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在我们要把环回路分为四段，在Z和X的数组之间交替。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; ySize; y++, v++) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> q = <span class="number">0</span>; q &lt; xSize; q++, v++) &#123;</div><div class="line">        tZ = SetQuad(trianglesZ, tZ, v, v + <span class="number">1</span>, v + ring, v + ring + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> q = <span class="number">0</span>; q &lt; zSize; q++, v++) &#123;</div><div class="line">        tX = SetQuad(trianglesX, tX, v, v + <span class="number">1</span>, v + ring, v + ring + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> q = <span class="number">0</span>; q &lt; xSize; q++, v++) &#123;</div><div class="line">        tZ = SetQuad(trianglesZ, tZ, v, v + <span class="number">1</span>, v + ring, v + ring + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> q = <span class="number">0</span>; q &lt; zSize - <span class="number">1</span>; q++, v++) &#123;</div><div class="line">        tX = SetQuad(trianglesX, tX, v, v + <span class="number">1</span>, v + ring, v + ring + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    tX = SetQuad(trianglesX, tX, v, v - ring + <span class="number">1</span>, v + ring, v + <span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>顶面和底面只用Y数组。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tY = CreateTopFace(trianglesY, tY, ring);</div><div class="line">tY = CreateBottomFace(trianglesY, tY, ring);</div></pre></td></tr></table></figure>
<p>我们创建三个子网格取代分配mesh.triangles。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mesh.subMeshCount = <span class="number">3</span>;</div><div class="line">mesh.SetTriangles(trianglesZ, <span class="number">0</span>);</div><div class="line">mesh.SetTriangles(trianglesX, <span class="number">1</span>);</div><div class="line">mesh.SetTriangles(trianglesY, <span class="number">2</span>);</div></pre></td></tr></table></figure>
<p><img src="/uploads/05-only-z.png" alt="只展示了两个面"></p>
<p>我们的网格现在被切成三块，只有第一块被实际渲染。 我们必须为网格渲染器分配额外的材质，即每个子网格一个。 这就是为什么有一个材质数组。</p>
<p><img src="/uploads/05-colored-faces.png" alt="三块子网格"><br><img src="/uploads/05-materials.png" alt="一组三材质"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接上回 Rounded Cube 2.本章主题如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Use sub-meshes. 使用子网格&lt;/li&gt;
&lt;li&gt;Create a custom shader. 使用自定义shader&lt;/li&gt;
&lt;li&gt;Combine primitive colliders. 合并原始网格&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此为本人阅读笔记不作为转载处理,详细还请参看原文. &lt;a href=&quot;http://catlikecoding.com/unity/tutorials/&quot;&gt;原文地址&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="翻译" scheme="http://vrast.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="UNITY3D" scheme="http://vrast.cn/tags/UNITY3D/"/>
    
  </entry>
  
  <entry>
    <title>Rounded Cube 2</title>
    <link href="http://vrast.cn/posts/ef6c9166/"/>
    <id>http://vrast.cn/posts/ef6c9166/</id>
    <published>2017-11-24T09:35:24.000Z</published>
    <updated>2017-11-25T14:56:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>接上回 Rounded Cube 1.本章主题如下:</p>
<ul>
<li>Define normals. 定义法线</li>
</ul>
<p>此为本人阅读笔记不作为转载处理,详细还请参看原文. <a href="http://catlikecoding.com/unity/tutorials/" target="_blank" rel="external">原文地址</a><br><a id="more"></a></p>
<h1 id="Rounding-the-Cube-圆形方块"><a href="#Rounding-the-Cube-圆形方块" class="headerlink" title="Rounding the Cube 圆形方块"></a>Rounding the Cube 圆形方块</h1><p>先设置一个<code>roundness</code>参数(数值)，并且添加法线字段。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> Vector3[] normals;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateVertices</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    …</div><div class="line">    vertices = <span class="keyword">new</span> Vector3[cornerVertices + edgeVertices + faceVertices];</div><div class="line">    normals = <span class="keyword">new</span> Vector3[vertices.Length];</div><div class="line"></div><div class="line">    …</div><div class="line"></div><div class="line">    mesh.vertices = vertices;</div><div class="line">    mesh.normals = normals;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们添加如下方法来计算对于每个顶点的法线<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateVertices</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		…</div><div class="line">    <span class="keyword">int</span> v = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt;= ySize; y++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= xSize; x++) &#123;</div><div class="line">            SetVertex(v++, x, y, <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt;= zSize; z++) &#123;</div><div class="line">            SetVertex(v++, xSize, y, z);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = xSize - <span class="number">1</span>; x &gt;= <span class="number">0</span>; x--) &#123;</div><div class="line">            SetVertex(v++, x, y, zSize);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> z = zSize - <span class="number">1</span>; z &gt; <span class="number">0</span>; z--) &#123;</div><div class="line">            SetVertex(v++, <span class="number">0</span>, y, z);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt; zSize; z++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize; x++) &#123;</div><div class="line">            SetVertex(v++, x, ySize, z);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt; zSize; z++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize; x++) &#123;</div><div class="line">            SetVertex(v++, x, <span class="number">0</span>, z);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    mesh.vertices = vertices;</div><div class="line">    mesh.normals = normals;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetVertex</span> (<span class="params"><span class="keyword">int</span> i, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z</span>) </span>&#123;</div><div class="line">    vertices[i] = <span class="keyword">new</span> Vector3(x, y, z);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>嗯。然后我们如何定位顶点呢？想象一下一个小一点的cube在原cube内部。这两cube之间的距离等于圆滑程度(值)。你可以想象圆粘在小立方体的角落上，它的半径就等于平滑值，所以内部的cube牢牢的抓住(外部的cube).</p>
<p>对于外部立方体上的任何点，在内部立方体中都有一个最靠近它的点.我们可以用这个来确定圆形cube的法线向量。</p>
<p><img src="/uploads/04-inner-cube.png" alt="想象另外一个立方体在里面"></p>
<p>圆形cube表面的点可以被起始于内部并且沿着法线方向移动的量等于圆滑值的点所达到。 –我的理解<br>圆形立方体的表面点可以从内点开始，沿着法线方向移动，其量等于圆度. – 百度翻译<br>The surface points of the rounded cube can then be found by starting at the inner point and moving along the normal by an amount equal to the roundness. – 原文</p>
<p>下面是参考代码，并未计算出内部的点<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetVertex</span> (<span class="params"><span class="keyword">int</span> i, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z</span>) </span>&#123;</div><div class="line">    Vector3 inner = vertices[i] = <span class="keyword">new</span> Vector3(x, y, z);</div><div class="line"></div><div class="line">    normals[i] = (vertices[i] - inner).normalized;</div><div class="line">    vertices[i] = inner + normals[i] * roundness;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在找到内部的点，开始检查x轴的坐标。如果小于圆滑值就在内部cube的左侧并且在内部x坐标就是简单的圆滑值。如果我们超出了立方体的x大小减去圆滑值，那么我们就在右边。在所有其他情况下，我们在内cube，点共享相同的x坐标范围</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetVertex</span> (<span class="params"><span class="keyword">int</span> i, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z</span>) </span>&#123;</div><div class="line">    Vector3 inner = vertices[i] = <span class="keyword">new</span> Vector3(x, y, z);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (x &lt; roundness) &#123;</div><div class="line">        inner.x = roundness;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">x &gt; xSize - roundness</span>) </span>&#123;</div><div class="line">        inner.x = xSize - roundness;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    normals[i] = (vertices[i] - inner).normalized;</div><div class="line">    vertices[i] = inner + normals[i] * roundness;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/04-rounded-x.png" alt="一维四舍五入相当平滑"></p>
<p>到目前为止，结果看起来并不圆润，但我们已经在正负X方向上获得了正常值。 对Y坐标进行同样的检查。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (x &lt; roundness) &#123;</div><div class="line">        inner.x = roundness;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">x &gt; xSize - roundness</span>) </span>&#123;</div><div class="line">        inner.x = xSize - roundness;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (y &lt; roundness) &#123;</div><div class="line">        inner.y = roundness;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">y &gt; ySize - roundness</span>) </span>&#123;</div><div class="line">        inner.y = ySize - roundness;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/04-rounded-xy.png" alt="在两个纬度上处理圆滑"></p>
<p>现在看起来好点了！ 圆角和法线在XY平面上工作。 剩下的就是检查Z坐标。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (x &lt; roundness) &#123;</div><div class="line">    inner.x = roundness;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">x &gt; xSize - roundness</span>) </span>&#123;</div><div class="line">    inner.x = xSize - roundness;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (y &lt; roundness) &#123;</div><div class="line">    inner.y = roundness;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">y &gt; ySize - roundness</span>) </span>&#123;</div><div class="line">    inner.y = ySize - roundness;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (z &lt; roundness) &#123;</div><div class="line">    inner.z = roundness;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">z &gt; zSize - roundness</span>) </span>&#123;</div><div class="line">    inner.z = zSize - roundness;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="/uploads/04-rounded-xyz.png" alt="完全圆滑"></p>
<p>我们终于有了一个完全圆润的立方体。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接上回 Rounded Cube 1.本章主题如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Define normals. 定义法线&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此为本人阅读笔记不作为转载处理,详细还请参看原文. &lt;a href=&quot;http://catlikecoding.com/unity/tutorials/&quot;&gt;原文地址&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="翻译" scheme="http://vrast.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="UNITY3D" scheme="http://vrast.cn/tags/UNITY3D/"/>
    
  </entry>
  
  <entry>
    <title>Rounded Cube 1</title>
    <link href="http://vrast.cn/posts/827b1a39/"/>
    <id>http://vrast.cn/posts/827b1a39/</id>
    <published>2017-11-20T15:47:55.000Z</published>
    <updated>2017-11-24T09:36:56.446Z</updated>
    
    <content type="html"><![CDATA[<p>上一章讲到Mesh的工作原理以及顶点与三角形的算法.本章主题如下:</p>
<ul>
<li>Create a cube with a seamless mesh. 创建无缝Mesh的立方体</li>
<li>Add rounded edges to the cube. 添加圆形边缘的立方体</li>
</ul>
<p>此为本人阅读笔记不作为转载处理,详细还请参看原文. <a href="http://catlikecoding.com/unity/tutorials/" target="_blank" rel="external">原文地址</a><br><a id="more"></a></p>
<h1 id="Compositing-a-Cube-组合-方式-一个立方体"><a href="#Compositing-a-Cube-组合-方式-一个立方体" class="headerlink" title="Compositing a Cube 组合(方式)一个立方体"></a>Compositing a Cube 组合(方式)一个立方体</h1><p>非重点,这里直接写实现思路.接上一章节生产面,只需修改每个面的角度位置.使其拼凑成为一个立方体即可.</p>
<p><img src="/uploads/QQ20170801-152656.png" alt="使用六个面拼凑一个立方体"></p>
<h1 id="Creating-Cube-Vertices-创建立方体的顶点"><a href="#Creating-Cube-Vertices-创建立方体的顶点" class="headerlink" title="Creating Cube Vertices 创建立方体的顶点"></a>Creating Cube Vertices 创建立方体的顶点</h1><h2 id="计算所需定点数量"><a href="#计算所需定点数量" class="headerlink" title="计算所需定点数量"></a>计算所需定点数量</h2><p>之前计算单个面的时候使用 <code>(#x + 1)(#y + 1)</code> 如下算法，那么可计算6个面的时候是不是可以直接套用单面的计算方式：<code>2((#x + 1)(#y + 1) + (#x + 1)(#z + 1) + (#y + 1)(#z + 1))</code> 结论是否定的，其中角顶点与边顶点都被重复计算了。</p>
<p><img src="/uploads/02-vertex-overlap.png" alt="顶点被重复计算次数的用颜色区分"></p>
<p>这其实也不是什么大问题。事实上顶点重复是非常常见的，譬如我们通常用网格创建锐角。所以我们可以创建6个面(的顶点)合并到单个数组里。<br>但是这不是我们打算做的，因为我们已经知道如何创建网格。我们的cube不需要有重复的顶点，这种做法很有趣。<br>我们需要多少顶点呢？让我们按类型分解，首先8个角顶点，这很简单。有12条边，每四条在同向。因为我们不包括角，每个边都有一个等于相应大小的顶点减去一个顶点。或者，把它看作四组x、y和z边。</p>
<p><code>4(#x + #y + #z - 3)</code></p>
<p>其余的顶点是那些位于面部边缘的顶点。这是相当于一个重复的顶点，其体积缩小了2</p>
<p><code>2((#x - 1)(#y - 1) + (#x - 1)(#z - 1) + (#y - 1)(#z - 1))</code></p>
<p>这样计算出的结果就是最终所需顶点数</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> IEnumerator <span class="title">Generate</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		GetComponent&lt;MeshFilter&gt;().mesh = mesh = <span class="keyword">new</span> Mesh();</div><div class="line">		mesh.name = <span class="string">"Procedural Cube"</span>;</div><div class="line">		WaitForSeconds wait = <span class="keyword">new</span> WaitForSeconds(<span class="number">0.05</span>f);</div><div class="line"></div><div class="line">		<span class="keyword">int</span> cornerVertices = <span class="number">8</span>;</div><div class="line">		<span class="keyword">int</span> edgeVertices = (xSize + ySize + zSize - <span class="number">3</span>) * <span class="number">4</span>;</div><div class="line">		<span class="keyword">int</span> faceVertices = (</div><div class="line">			(xSize - <span class="number">1</span>) * (ySize - <span class="number">1</span>) +</div><div class="line">			(xSize - <span class="number">1</span>) * (zSize - <span class="number">1</span>) +</div><div class="line">			(ySize - <span class="number">1</span>) * (zSize - <span class="number">1</span>)) * <span class="number">2</span>;</div><div class="line">		vertices = <span class="keyword">new</span> Vector3[cornerVertices + edgeVertices + faceVertices];</div><div class="line"></div><div class="line">		<span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>现在定位一个面上的第一行顶点就像定位网格上的第一行顶点。(参考章节.1)<br>基础的算法是从x(0,0)开始，计算算一圈的点</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> v = <span class="number">0</span>; <span class="comment">//索引</span></div><div class="line"><span class="comment">//算出X轴线的点</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= xSize; x++)</div><div class="line">&#123;</div><div class="line">    Vertices[v++] = <span class="keyword">new</span> Vector3(x, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">&#125;</div><div class="line"><span class="comment">//算出y轴线的点</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt;= zSize; z++)</div><div class="line">&#123;</div><div class="line">    Vertices[v++] = <span class="keyword">new</span> Vector3(xSize, <span class="number">0</span>, z);</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">&#125;</div><div class="line"><span class="comment">//x轴线背后的点</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = (<span class="keyword">int</span>)xSize - <span class="number">1</span>; x &gt;= <span class="number">0</span>; x--)</div><div class="line">&#123;</div><div class="line">    Vertices[v++] = <span class="keyword">new</span> Vector3(x, <span class="number">0</span>, zSize);</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">&#125;</div><div class="line"><span class="comment">//z轴线背后的点</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> z = (<span class="keyword">int</span>)zSize - <span class="number">1</span>; z &gt; <span class="number">0</span>; z--)</div><div class="line">&#123;</div><div class="line">    Vertices[v++] = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, z);</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由以上基础我们可以直接绘制出第0层至顶层的点<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> v = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt;= ySize; y++)</div><div class="line">&#123;</div><div class="line">    <span class="comment">//算出X轴线的点</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= xSize; x++)</div><div class="line">    &#123;</div><div class="line">        Vertices[v++] = <span class="keyword">new</span> Vector3(x, y, <span class="number">0</span>);</div><div class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//算出y轴线的点</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt;= zSize; z++)</div><div class="line">    &#123;</div><div class="line">        Vertices[v++] = <span class="keyword">new</span> Vector3(xSize, y, z);</div><div class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//x轴线背后的点</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = (<span class="keyword">int</span>)xSize - <span class="number">1</span>; x &gt;= <span class="number">0</span>; x--)</div><div class="line">    &#123;</div><div class="line">        Vertices[v++] = <span class="keyword">new</span> Vector3(x, y, zSize);</div><div class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//z轴线背后的点</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> z = (<span class="keyword">int</span>)zSize - <span class="number">1</span>; z &gt; <span class="number">0</span>; z--)</div><div class="line">    &#123;</div><div class="line">        Vertices[v++] = <span class="keyword">new</span> Vector3(<span class="number">0</span>, y, z);</div><div class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//顶层内部的点</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt; zSize; z++)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize; x++)</div><div class="line">    &#123;</div><div class="line">        Vertices[v++] = <span class="keyword">new</span> Vector3(x, ySize, z);</div><div class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//底层内部的点</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt; zSize; z++)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize; x++)</div><div class="line">    &#123;</div><div class="line">        Vertices[v++] = <span class="keyword">new</span> Vector3(x, <span class="number">0</span>, z);</div><div class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Add-rounded-edges-to-the-cube-添加圆形边缘的立方体"><a href="#Add-rounded-edges-to-the-cube-添加圆形边缘的立方体" class="headerlink" title="Add rounded edges to the cube. 添加圆形边缘的立方体"></a>Add rounded edges to the cube. 添加圆形边缘的立方体</h1><p>和上一章类似，我们这样绘制四边形<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span></span></div><div class="line"><span class="title">SetQuad</span> (<span class="params"><span class="keyword">int</span>[] triangles, <span class="keyword">int</span> i, <span class="keyword">int</span> v00, <span class="keyword">int</span> v10, <span class="keyword">int</span> v01, <span class="keyword">int</span> v11</span>) &#123;</div><div class="line">    triangles[i] = v00;</div><div class="line">    triangles[i + <span class="number">1</span>] = triangles[i + <span class="number">4</span>] = v01;</div><div class="line">    triangles[i + <span class="number">2</span>] = triangles[i + <span class="number">3</span>] = v10;</div><div class="line">    triangles[i + <span class="number">5</span>] = v11;</div><div class="line">    <span class="keyword">return</span> i + <span class="number">6</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="/uploads/03-quad.png" alt="四边形图解"></p>
<p>与顶点不同，三角形的数目等于六个面的总和。他们是否使用共享顶点并不重要。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateTriangles</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">int</span> quads = (<span class="keyword">int</span>)(xSize * ySize + xSize * zSize + ySize * zSize) * <span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span>[] triangles = <span class="keyword">new</span> <span class="keyword">int</span>[quads * <span class="number">6</span>];</div><div class="line">    mesh.triangles = triangles;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建横向的三角方式与创建网格的做法相同。至此为止位置不同的是顶点在下一行的偏移相当全部的环形顶点之和。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateTriangles</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">int</span> quads = (xSize * ySize + xSize * zSize + ySize * zSize) * <span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span>[] triangles = <span class="keyword">new</span> <span class="keyword">int</span>[quads * <span class="number">6</span>];</div><div class="line">    <span class="keyword">int</span> ring = (xSize + zSize) * <span class="number">2</span>; <span class="comment">//计算环偏移</span></div><div class="line">    <span class="keyword">int</span> t = <span class="number">0</span>, v = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; ySize; y++, v++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> q = <span class="number">0</span>; q &lt; ring - <span class="number">1</span>; q++, v++) &#123;</div><div class="line">            t = SetQuad(triangles, t, v, v + <span class="number">1</span>, v + ring, v + ring + <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        t = SetQuad(triangles, t, v, v - ring + <span class="number">1</span>, v + ring, v + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    t = CreateTopFace(triangles, t, ring);</div><div class="line">    t = CreateBottomFace(triangles, t, ring);</div><div class="line">    mesh.triangles = triangles;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>很不幸顶部与底部的面并不简单。顶点的布局就像是一个网格被环包围。</p>
<p><img src="/uploads/03-cap.png" alt="盖子就像在环里的网格"></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">CreateTopFace</span> (<span class="params"><span class="keyword">int</span>[] triangles, <span class="keyword">int</span> t, <span class="keyword">int</span> ring</span>) </span>&#123;</div><div class="line">    <span class="keyword">int</span> v = ring * ySize;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; xSize - <span class="number">1</span>; x++, v++) &#123;</div><div class="line">        t = SetQuad(triangles, t, v, v + <span class="number">1</span>, v + ring - <span class="number">1</span>, v + ring);</div><div class="line">    &#125;</div><div class="line">    t = SetQuad(triangles, t, v, v + <span class="number">1</span>, v + ring - <span class="number">1</span>, v + <span class="number">2</span>);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> vMin = ring * (ySize + <span class="number">1</span>) - <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> vMid = vMin + <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> vMax = v + <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt; zSize - <span class="number">1</span>; z++, vMin--, vMid++, vMax++) &#123;</div><div class="line">        t = SetQuad(triangles, t, vMin, vMid, vMin - <span class="number">1</span>, vMid + xSize - <span class="number">1</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize - <span class="number">1</span>; x++, vMid++) &#123;</div><div class="line">            t = SetQuad(</div><div class="line">                triangles, t,</div><div class="line">                vMid, vMid + <span class="number">1</span>, vMid + xSize - <span class="number">1</span>, vMid + xSize);</div><div class="line">        &#125;</div><div class="line">        t = SetQuad(triangles, t, vMid, vMax, vMid + xSize - <span class="number">1</span>, vMax + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> vTop = vMin - <span class="number">2</span>;</div><div class="line">    t = SetQuad(triangles, t, vMin, vMid, vTop + <span class="number">1</span>, vTop);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize - <span class="number">1</span>; x++, vTop--, vMid++) &#123;</div><div class="line">        t = SetQuad(triangles, t, vMid, vMid + <span class="number">1</span>, vTop, vTop - <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    t = SetQuad(triangles, t, vMid, vTop - <span class="number">2</span>, vTop, vTop - <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">CreateBottomFace</span> (<span class="params"><span class="keyword">int</span>[] triangles, <span class="keyword">int</span> t, <span class="keyword">int</span> ring</span>) </span>&#123;</div><div class="line">    <span class="keyword">int</span> v = <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> vMid = vertices.Length - (xSize - <span class="number">1</span>) * (zSize - <span class="number">1</span>);</div><div class="line">    t = SetQuad(triangles, t, ring - <span class="number">1</span>, vMid, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize - <span class="number">1</span>; x++, v++, vMid++) &#123;</div><div class="line">        t = SetQuad(triangles, t, vMid, vMid + <span class="number">1</span>, v, v + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    t = SetQuad(triangles, t, vMid, v + <span class="number">2</span>, v, v + <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> vMin = ring - <span class="number">2</span>;</div><div class="line">    vMid -= xSize - <span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> vMax = v + <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span>; z &lt; zSize - <span class="number">1</span>; z++, vMin--, vMid++, vMax++) &#123;</div><div class="line">        t = SetQuad(triangles, t, vMin, vMid + xSize - <span class="number">1</span>, vMin + <span class="number">1</span>, vMid);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize - <span class="number">1</span>; x++, vMid++) &#123;</div><div class="line">            t = SetQuad(</div><div class="line">                triangles, t,</div><div class="line">                vMid + xSize - <span class="number">1</span>, vMid + xSize, vMid, vMid + <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        t = SetQuad(triangles, t, vMid + xSize - <span class="number">1</span>, vMax + <span class="number">1</span>, vMid, vMax);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> vTop = vMin - <span class="number">1</span>;</div><div class="line">    t = SetQuad(triangles, t, vTop + <span class="number">1</span>, vTop, vTop + <span class="number">2</span>, vMid);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; xSize - <span class="number">1</span>; x++, vTop--, vMid++) &#123;</div><div class="line">        t = SetQuad(triangles, t, vTop, vTop - <span class="number">1</span>, vMid, vMid + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    t = SetQuad(triangles, t, vTop, vTop - <span class="number">1</span>, vMid, vTop - <span class="number">2</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上一章讲到Mesh的工作原理以及顶点与三角形的算法.本章主题如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a cube with a seamless mesh. 创建无缝Mesh的立方体&lt;/li&gt;
&lt;li&gt;Add rounded edges to the cube. 添加圆形边缘的立方体&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此为本人阅读笔记不作为转载处理,详细还请参看原文. &lt;a href=&quot;http://catlikecoding.com/unity/tutorials/&quot;&gt;原文地址&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="翻译" scheme="http://vrast.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="UNITY3D" scheme="http://vrast.cn/tags/UNITY3D/"/>
    
  </entry>
  
  <entry>
    <title>庆祝会英语的宝狄上线</title>
    <link href="http://vrast.cn/posts/39b36a57/"/>
    <id>http://vrast.cn/posts/39b36a57/</id>
    <published>2017-10-13T02:43:08.000Z</published>
    <updated>2017-10-13T10:17:23.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>本项目在10.8 360平台首发，求下载 求转发 求关注。</p>
</blockquote>
<p><img src="/uploads/8461507863792_.pic_hd.jpg" alt="会英语的宝狄"><br><a href="http://zhushou.360.cn/search/index/?kw=%E4%BC%9A%E8%8B%B1%E8%AF%AD%E7%9A%84%E5%AE%9D%E7%8B%84" target="_blank" rel="external">电脑端下载链接-Link</a></p>
<a id="more"></a>
<h2 id="给开发者分享一些经验"><a href="#给开发者分享一些经验" class="headerlink" title="给开发者分享一些经验"></a>给开发者分享一些经验</h2><ol>
<li>使用 Android Studio 需要提前部署所需平台环境，如果你的网络环境不友好 BUILD TOOLS 不是很好下载就要在网上找代理。推荐购买 VPN 。</li>
<li>如果使用插件 请单独建 Plugins 工程，注意xml配置的统一。</li>
<li>使用 aar 而非 jar 包 ,aar 可以包含多个 jar 包与 layout文件。</li>
<li>发布前检查宏定义。</li>
<li>检查splash裁切方式。</li>
<li>使用第三方一定要找到客服的联系方式 最好加上QQ。实在不行用邮件。</li>
<li>做好充分的测试，使用新账户以用户的流程测试。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;本项目在10.8 360平台首发，求下载 求转发 求关注。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/uploads/8461507863792_.pic_hd.jpg&quot; alt=&quot;会英语的宝狄&quot;&gt;&lt;br&gt;&lt;a href=&quot;http://zhushou.360.cn/search/index/?kw=%E4%BC%9A%E8%8B%B1%E8%AF%AD%E7%9A%84%E5%AE%9D%E7%8B%84&quot;&gt;电脑端下载链接-Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="PROJECT" scheme="http://vrast.cn/categories/PROJECT/"/>
    
    
      <category term="PROJECT" scheme="http://vrast.cn/tags/PROJECT/"/>
    
  </entry>
  
  <entry>
    <title>微信二维码支付接入流程</title>
    <link href="http://vrast.cn/posts/cec4451/"/>
    <id>http://vrast.cn/posts/cec4451/</id>
    <published>2017-09-08T09:47:39.000Z</published>
    <updated>2017-10-13T02:58:35.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>这阵子天天接SDK，没事出来分享下一些经验 主要是微信支付相关。使用二维码支付能在极短的时间内完成支付流程。</p>
</blockquote>
<a id="more"></a>
<h1 id="注册商户平台"><a href="#注册商户平台" class="headerlink" title="注册商户平台"></a>注册商户平台</h1><p> <a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F" target="_blank" rel="external">🔗 注册链接</a></p>
<p><img src="/uploads/QQ20171013-105237.png" alt="这里使用商户二维码支付，可以移交给服务器同学了"><br><a href="https://pay.weixin.qq.com/guide/qrcode_payment.shtml" target="_blank" rel="external">服务器文档在这里</a></p>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>我这边让服务器同学接入了php版本的服务端，转发到c++服务器，这里推荐大家尽量避免tencent的代码改动。通过转发与代理的方式接入服务器是最快的。客户端发送订单请求给服务器，服务器将对应的请求给tencent，返回的一串key可以拼接到tencent给的url中，最后将这串url发送给客户端(需要加密)，客户端再请求微信直接刷出二维码。用户支付完毕，tencent会通知商户，服务器再发送支付成功的消息给客户端。支付流程结束！</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;这阵子天天接SDK，没事出来分享下一些经验 主要是微信支付相关。使用二维码支付能在极短的时间内完成支付流程。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="SDK" scheme="http://vrast.cn/categories/SDK/"/>
    
    
      <category term="Tencent" scheme="http://vrast.cn/tags/Tencent/"/>
    
  </entry>
  
  <entry>
    <title>UniwebView Recompile</title>
    <link href="http://vrast.cn/posts/bc9c7b23/"/>
    <id>http://vrast.cn/posts/bc9c7b23/</id>
    <published>2017-09-06T04:03:22.000Z</published>
    <updated>2017-09-06T09:40:12.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>现在项目接入UniwebView同时需要接入其他SDk,所以这里记录一下UniwebView的重编译过程。仅供参考。有点东西想吐槽，这个插件是中国人写的但是文档并不友好。最后呼吁支持正版，花点钱支持一下这个项目。哈哈</p>
</blockquote>
<a id="more"></a>
<h2 id="解决方案如下"><a href="#解决方案如下" class="headerlink" title="解决方案如下"></a>解决方案如下</h2><ol>
<li>解压 Assets/UniWebView/Source.zip 下脚本，复制到新工程中</li>
</ol>
<p><img src="/uploads/QQ20170906-173407.png" alt="创建PluginLibrary"></p>
<p>因为采用AndroidStudio Labrary打包的方式所以可以直接导出 aar的包，省去了很多麻烦。最终的unity工程直接添加aar进行编译</p>
<ol>
<li><p>在Unity工程中的Build.Gradle脚本的<code>dependencies</code>下添加:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">compile</span>(<span class="attribute">name</span>: <span class="string">'uniwebview-release'</span>, <span class="attribute">ext</span>: <span class="string">'aar'</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>删除在unity工程的libs下与aar之中重复的jar包。</p>
</li>
</ol>
<h1 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h1><p><a href="http://uniwebview.onevcat.com/manual" target="_blank" rel="external">Document Link</a></p>
<ol>
<li>You need the SDK of Android installed. Please refer to the Android developer site for more information.</li>
<li>You need Apache Ant installed to compile java from command line. This tool is installed on Mac by default, you can run which ant in terminal to confirm if it is installed. If not, please refer to this post or the ant’s official site for more information to install it.</li>
<li>Download the UniWebView’s customize compile script package from here and unzip it to a folder (we will call it “compile folder” later). This package is for Unix based system (such as Mac), but you can adapt it for Windows if needed easily.</li>
<li>And of course, you need the source code of UniWebView Android, which is bundled with this package under the folder /Assets/UniWebView/Source/Android/ after you import it.</li>
</ol>
<h2 id="我并没有采用ant构建而是使用Gradle构建Labrary-下面是查看本机ant环境的小技巧"><a href="#我并没有采用ant构建而是使用Gradle构建Labrary-下面是查看本机ant环境的小技巧" class="headerlink" title="我并没有采用ant构建而是使用Gradle构建Labrary 下面是查看本机ant环境的小技巧"></a>我并没有采用ant构建而是使用Gradle构建Labrary 下面是查看本机ant环境的小技巧</h2><p>这里我检查了下本机Ant是否存在<code>which ant</code><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">keyle</span>@<span class="keyword">keyles</span>-<span class="keyword">MacBook</span>-<span class="keyword">Pro</span>  ~/keylexiao/source/_posts  which ant</div><div class="line">ant not found</div></pre></td></tr></table></figure></p>
<p>如果像我一样没有ant就用 <a href="http://sdkman.io/" target="_blank" rel="external">SDKMan</a> 安装一下</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">keyle@keyles-MacBook-Pro  ~/keylexiao/source/_posts  sdk install ant</div><div class="line"></div><div class="line">Downloading: ant <span class="number">1.10</span><span class="number">.1</span></div><div class="line"></div><div class="line">In progress...</div><div class="line"></div><div class="line">######################################################################## <span class="number">100.0</span>%</div><div class="line"></div><div class="line">Installing: ant <span class="number">1.10</span><span class="number">.1</span></div><div class="line">Done installing!</div><div class="line"></div><div class="line">Setting ant <span class="number">1.10</span><span class="number">.1</span> <span class="keyword">as</span> default.</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;现在项目接入UniwebView同时需要接入其他SDk,所以这里记录一下UniwebView的重编译过程。仅供参考。有点东西想吐槽，这个插件是中国人写的但是文档并不友好。最后呼吁支持正版，花点钱支持一下这个项目。哈哈&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="SDK" scheme="http://vrast.cn/categories/SDK/"/>
    
    
      <category term="UniwebView" scheme="http://vrast.cn/tags/UniwebView/"/>
    
  </entry>
  
  <entry>
    <title>AndroidStudio 堆内存爆炸导致无法打包</title>
    <link href="http://vrast.cn/posts/831cd9e6/"/>
    <id>http://vrast.cn/posts/831cd9e6/</id>
    <published>2017-09-05T08:11:54.000Z</published>
    <updated>2017-09-05T08:32:29.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>最近忙着项目上线，因为要接入优酷云的Android SDK所以Gradle用的比较多，期间遇到很多奇怪的问题，所幸一一解决。这里我总结记录下一些解决方案，以供大家参考。</p>
<ul>
<li>Android Studio - Gradle build failing - Java Heap Space 堆内存爆炸</li>
<li>Gradle download failing Gradle升级失败</li>
</ul>
</blockquote>
<a id="more"></a>
<h1 id="Android-Studio-Gradle-build-failing-Java-Heap-Space-堆内存爆炸"><a href="#Android-Studio-Gradle-build-failing-Java-Heap-Space-堆内存爆炸" class="headerlink" title="Android Studio - Gradle build failing - Java Heap Space 堆内存爆炸"></a>Android Studio - Gradle build failing - Java Heap Space 堆内存爆炸</h1><p>我现在的项目导出工程有超过5G大小，很幸运的爆炸了.在 <a href="https://stackoverflow.com/questions/41645747/android-studio-gradle-build-failing-java-heap-space" target="_blank" rel="external">StackOverflow</a> 上有人遇到和我相同的问题，也提供了解决方案。</p>
<p>在工程根目录 <code>gradle.properties</code> 添加如下代码<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">org<span class="selector-class">.gradle</span><span class="selector-class">.jvmargs</span>=-XX\:MaxHeapSize\=<span class="number">256</span>m -Xmx256m</div></pre></td></tr></table></figure></p>
<p>StackOverflow并未提供关于此参数的解释，正确的用法是此参数限定了Gradle的性能，最高可用内存。因为我的项目比较大 我改为2G<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">org<span class="selector-class">.gradle</span><span class="selector-class">.jvmargs</span>=-XX\:MaxHeapSize\=<span class="number">2048</span>m -Xmx2048m</div></pre></td></tr></table></figure></p>
<h1 id="Gradle-download-failing-Gradle升级失败"><a href="#Gradle-download-failing-Gradle升级失败" class="headerlink" title="Gradle download failing Gradle升级失败"></a>Gradle download failing Gradle升级失败</h1><p>关于这个问题 我在<a href="https://vrast.cn/posts/84e9a39b/">上一篇文章</a> 中写道可以 <a href="https://vrast.cn/posts/84e9a39b/">使用代理</a> 与 <a href="http://sdkman.io" target="_blank" rel="external">SDKMan</a> 来解决。<br>但是，仍旧没有解决问题的可以参照我现在的新办法。</p>
<ol>
<li>using Android Studio Import your UnityProject</li>
<li>open <code>gradle-wrapper.properties</code> and replace “distributionUrl” with “https\://services.gradle.org/distributions/gradle-2.14.1-all.zip”</li>
<li>click “Sync Now”<br>这个问题出在升级的版本上，目前没有找到很好的办法解决这个问题。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;最近忙着项目上线，因为要接入优酷云的Android SDK所以Gradle用的比较多，期间遇到很多奇怪的问题，所幸一一解决。这里我总结记录下一些解决方案，以供大家参考。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio - Gradle build failing - Java Heap Space 堆内存爆炸&lt;/li&gt;
&lt;li&gt;Gradle download failing Gradle升级失败&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Android Studio" scheme="http://vrast.cn/categories/Android-Studio/"/>
    
    
      <category term="Gradle" scheme="http://vrast.cn/tags/Gradle/"/>
    
  </entry>
  
  <entry>
    <title>AndroidStudio Gradle水土不服解决方案</title>
    <link href="http://vrast.cn/posts/84e9a39b/"/>
    <id>http://vrast.cn/posts/84e9a39b/</id>
    <published>2017-09-01T03:50:46.000Z</published>
    <updated>2017-10-13T03:30:03.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>因为外星人在中国布下了GFW，导致使用android studio的时候故障频发。集中体现在<br><code>Gradle sync failed xxxxxx 与 AndroidStudio Gradle:Resolvedependencies xxxxxx</code>这两个问题上,本章提供两个解决方案给大家。看本文前你要准备下面几种工具</p>
<ul>
<li>brew</li>
<li>Shadowsocks</li>
<li>polipo</li>
<li>sdkman (可选)<br>本章节有三种解决方案 ，我使用的是第三种<a id="more"></a>
</li>
</ul>
</blockquote>
<h1 id="解决方案一-使用在线更新"><a href="#解决方案一-使用在线更新" class="headerlink" title="解决方案一 使用在线更新"></a>解决方案一 使用在线更新</h1><p>Homebrew 一般是自带的，如果没有自带 建议你装一个。 <a href="https://brew.sh" target="_blank" rel="external">https://brew.sh</a><br>Shadowsocks 是某种不知名的代理<br>polipo 是能将Socks转为http代理的工具</p>
<h2 id="polipo使用说明"><a href="#polipo使用说明" class="headerlink" title="polipo使用说明"></a>polipo使用说明</h2><p>以下转载自<a href="http://qichunren.github.io/tool/2014/07/15/Convert-shadowsocks-into-http-proxy-on-mac/" target="_blank" rel="external">蕲春人的博客</a><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">brew install polipo</div><div class="line">然后就是启动polipo程序开机自动启动。</div><div class="line"></div><div class="line">首先要修改自动启动的配置文件 /usr/local/opt/polipo/homebrew.mxcl.polipo.plist，需要给polipo命令加上命令行参数 socksParentProxy=localhost:1080</div><div class="line"></div><div class="line">  <span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line">  <span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">string</span>&gt;</span>homebrew.mxcl.polipo<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">true</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">true</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">array</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>/usr/local/opt/polipo/bin/polipo<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>socksParentProxy=localhost:1080<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">array</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">plist</span>&gt;</span></div><div class="line">然后执行以下命令，搞定收工。</div><div class="line"></div><div class="line">ln -sfv /usr/local/opt/polipo/*.plist ~/Library/LaunchAgents</div><div class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.polipo.plist</div><div class="line">polipo进程默认监听8123端口，在命令行使用export http_proxy=http://localhost:8123 就可以使用代理了。</div><div class="line"></div><div class="line">export https_proxy=http://localhost:8123 export ftp_proxy=http://localhost:8123</div></pre></td></tr></table></figure></p>
<h2 id="AndroidStudio代理配置"><a href="#AndroidStudio代理配置" class="headerlink" title="AndroidStudio代理配置"></a>AndroidStudio代理配置</h2><p>这里你直接在Preferences搜索proxy即可<br><img src="/uploads/QQ20170901-115902.png" alt="配置详情"></p>
<h1 id="解决方案二-使用离线gradle"><a href="#解决方案二-使用离线gradle" class="headerlink" title="解决方案二 使用离线gradle"></a>解决方案二 使用离线gradle</h1><p>我使用的是方案一，同时使用了方案二，直接用sdkman来更新本地gradle版本。<br>这两种方案是兼容的，你可以选择使用本地还是在线更新。</p>
<p><img src="/uploads/QQ20170901-120202.png" alt="配置详情"></p>
<h2 id="sdkman配置"><a href="#sdkman配置" class="headerlink" title="sdkman配置"></a>sdkman配置</h2><ol>
<li><p>在terminal中使用如下脚本安装sdkman.  –<a href="http://sdkman.io" target="_blank" rel="external">官网</a></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ curl -s <span class="string">"https://get.sdkman.io"</span> <span class="string">| bash</span></div></pre></td></tr></table></figure>
</li>
<li><p>下载安装完毕重启terminal<br>使用此命令下载指定的gradle版本</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sdk <span class="keyword">install</span> gradle <span class="number">2.1</span>(版本号)</div></pre></td></tr></table></figure>
</li>
<li><p>查看当前所有的gradle版本信息<br>前面有<code>*</code>符号的为当前本地下载的版本。<code>&gt;</code>符号指向的为当前使用的版本。</p>
</li>
</ol>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sdk <span class="built_in">list</span> gradle</div></pre></td></tr></table></figure>
<p><img src="/uploads/QQ20170901-120809@2x.png" alt="配置详情"></p>
<ol>
<li><p>更换当前gradle版本<br>使用此命令可以更换当前环境变量重的gradle版本</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sdk <span class="keyword">use</span> gradle <span class="number">4.1</span></div></pre></td></tr></table></figure>
</li>
<li><p>查看gradle路径(重要)<br>使用下面的命令可以看到当前sdk使用的gradle版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="variable">$GRADLE_HOME</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="解决方案三-黑科技"><a href="#解决方案三-黑科技" class="headerlink" title="解决方案三 黑科技"></a>解决方案三 黑科技</h1><p> 更新gradle版本到 2.14.1<br> distributionUrl=https\://services.gradle.org/distributions/gradle- 2.14.1-all.zip</p>
<p>请统一如下配置：<br>Compile Sdk Version 设置到: API 23:Android 6.0(Marshmallow)<br>Build Tools Version 设置到： 25.0.0</p>
<p>完美解决！</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;因为外星人在中国布下了GFW，导致使用android studio的时候故障频发。集中体现在&lt;br&gt;&lt;code&gt;Gradle sync failed xxxxxx 与 AndroidStudio Gradle:Resolvedependencies xxxxxx&lt;/code&gt;这两个问题上,本章提供两个解决方案给大家。看本文前你要准备下面几种工具&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;brew&lt;/li&gt;
&lt;li&gt;Shadowsocks&lt;/li&gt;
&lt;li&gt;polipo&lt;/li&gt;
&lt;li&gt;sdkman (可选)&lt;br&gt;本章节有三种解决方案 ，我使用的是第三种
    
    </summary>
    
      <category term="Android Studio" scheme="http://vrast.cn/categories/Android-Studio/"/>
    
    
      <category term="Gradle" scheme="http://vrast.cn/tags/Gradle/"/>
    
  </entry>
  
  <entry>
    <title>Procedural Grid</title>
    <link href="http://vrast.cn/posts/b5aaa1c8/"/>
    <id>http://vrast.cn/posts/b5aaa1c8/</id>
    <published>2017-07-26T03:26:55.000Z</published>
    <updated>2017-08-01T02:57:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>此主题分为四个部分讲述Mesh相关技术.本章主题如下:</p>
<ul>
<li>Create a grid of points. 创建由点构成的网格. </li>
<li>Use a coroutine to analyze their placement. 使用协程分析它们的位置信息.</li>
<li>Define a surface with triangles. 使用三角形来定义表面. </li>
<li>Automatically generate normals. 自动生成法线. </li>
<li>Add texture coordinates and tangents. 添加贴图坐标与切线. </li>
</ul>
<p>此为本人阅读笔记不作为转载处理,详细还请参看原文. <a href="http://catlikecoding.com/unity/tutorials/" target="_blank" rel="external">原文地址</a></p>
<a id="more"></a>
<p>在此教程里我们将创建简单的网格与三角面.</p>
<p>复杂的外表之下是简单的网格.<br>Beneath complex appearance lies simple geometry.</p>
<h1 id="Rendering-Things-渲染物体"><a href="#Rendering-Things-渲染物体" class="headerlink" title="Rendering Things 渲染物体"></a>Rendering Things 渲染物体</h1><p>如果你想让某些物体在Unity中可见，要用网格.它可能是从其他程序导入的3D模型.它可能是程序生成的网格.可能是Sprite,UI元素,或者粒子系统.Unity就是如此使用网格.所有的屏幕特效也都是mesh渲染出来的.</p>
<p>如果你想使某3D物体可见,需要添加两个组件 mesh filter &amp; mesh renderer .mesh render 用来配置这个mesh是如何渲染.</p>
<h1 id="Creating-a-Grid-of-Vertices-创建网格顶点"><a href="#Creating-a-Grid-of-Vertices-创建网格顶点" class="headerlink" title="Creating a Grid of Vertices 创建网格顶点"></a>Creating a Grid of Vertices 创建网格顶点</h1><p>这里有一个概念我要提出,关于顺时针与逆时针的.假定我们从Z轴方向看物体,只能看到顺时针连接顶点的面,反之也是.</p>
<p><img src="/uploads/03-triangle-sides.png" alt="顺时针与逆时针"></p>
<h2 id="演示三角面形成"><a href="#演示三角面形成" class="headerlink" title="演示三角面形成"></a>演示三角面形成</h2><p>在下面的代码里 有三处注释的地方演示了分别连接三顶点形成正方形的三种情况.只是链接顺序不一样但都是顺时针,所以都可以在Z轴正常看到.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"></div><div class="line">[RequireComponent (<span class="keyword">typeof</span> (MeshFilter), <span class="keyword">typeof</span> (MeshRenderer))]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Grid</span> : <span class="title">MonoBehaviour</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">int</span> xSize, ySize;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="keyword">private</span> Vector3 [] vertices;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">    StartCoroutine (Generate ());</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">private</span> Mesh mesh;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> IEnumerator <span class="title">Generate</span> (<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">    WaitForSeconds wait = <span class="keyword">new</span> WaitForSeconds (<span class="number">0.05</span>f);</div><div class="line"></div><div class="line">    GetComponent&lt;MeshFilter&gt; ().mesh = mesh = <span class="keyword">new</span> Mesh ();</div><div class="line">    mesh.name = <span class="string">"Procedural Grid"</span>;</div><div class="line"></div><div class="line">    vertices = <span class="keyword">new</span> Vector3 [(xSize + <span class="number">1</span>) * (ySize + <span class="number">1</span>)];</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, y = <span class="number">0</span>; y &lt;= ySize; y++) &#123;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= xSize; x++, i++) &#123;</div><div class="line">        vertices [i] = <span class="keyword">new</span> Vector3 (x, y);</div><div class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> wait;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    mesh.vertices = vertices;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> [] triangles = <span class="keyword">new</span> <span class="keyword">int</span> [<span class="number">6</span>];</div><div class="line">    <span class="comment">//triangles [0] = 0;</span></div><div class="line">    <span class="comment">//triangles [1] = xSize + 1;</span></div><div class="line">    <span class="comment">//triangles [2] = xSize + 2;</span></div><div class="line">    <span class="comment">//triangles [3] = xSize + 2;</span></div><div class="line">    <span class="comment">//triangles [4] = 1;</span></div><div class="line">    <span class="comment">//triangles [5] = 0;</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//triangles [0] = 1;</span></div><div class="line">    <span class="comment">//triangles [1] = 0;</span></div><div class="line">    <span class="comment">//triangles [2] = xSize + 1;</span></div><div class="line">    <span class="comment">//triangles [3] = xSize + 2;</span></div><div class="line">    <span class="comment">//triangles [4] = 1;</span></div><div class="line">    <span class="comment">//triangles [5] = xSize + 1;</span></div><div class="line"></div><div class="line">    <span class="comment">//triangles [0] = xSize + 1;</span></div><div class="line">    <span class="comment">//triangles [1] = xSize + 2;</span></div><div class="line">    <span class="comment">//triangles [2] = 0;</span></div><div class="line">    <span class="comment">//triangles [3] = xSize + 2;</span></div><div class="line">    <span class="comment">//triangles [4] = 1;</span></div><div class="line">    <span class="comment">//triangles [5] = 0;</span></div><div class="line"></div><div class="line">    mesh.triangles = triangles;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDrawGizmos</span> (<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (vertices == <span class="literal">null</span>) &#123;</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    Gizmos.color = Color.black;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vertices.Length; i++) &#123;</div><div class="line">      Gizmos.DrawSphere (vertices [i], <span class="number">0.1</span>f);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="绘制正方形算法"><a href="#绘制正方形算法" class="headerlink" title="绘制正方形算法"></a>绘制正方形算法</h2><p>如下算法直接可以按照定义尺寸(xSize,ySize)渲染出正方形.算法优点绕，我这里简单说一下。</p>
<p>第一步,创建顶点列表 从(0,0) 开始计算.<br>第二步,因为一个正方形的面由两个三角组成,需要连线 3*2=6 次.每次循环内都渲染一个正方形.</p>
<p><img src="/uploads/02-grid-indices.png" alt="绘制顺序"></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">vertices = <span class="keyword">new</span> Vector3 [(xSize + <span class="number">1</span>) * (ySize + <span class="number">1</span>)];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, y = <span class="number">0</span>; y &lt;= ySize; y++) &#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= xSize; x++, i++) &#123;</div><div class="line">    vertices [i] = <span class="keyword">new</span> Vector3 (x, y);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">mesh.vertices = vertices;</div><div class="line"></div><div class="line"><span class="keyword">int</span> [] triangles = <span class="keyword">new</span> <span class="keyword">int</span> [xSize * ySize * <span class="number">6</span>];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> ti = <span class="number">0</span>, vi = <span class="number">0</span>, y = <span class="number">0</span>; y &lt; ySize; y++, vi++) &#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; xSize; x++, ti += <span class="number">6</span>, vi++) &#123;</div><div class="line">    triangles [ti] = vi;</div><div class="line">    triangles [ti + <span class="number">3</span>] = triangles [ti + <span class="number">2</span>] = vi + <span class="number">1</span>;</div><div class="line">    triangles [ti + <span class="number">4</span>] = triangles [ti + <span class="number">1</span>] = vi + xSize + <span class="number">1</span>;</div><div class="line">    triangles [ti + <span class="number">5</span>] = vi + xSize + <span class="number">2</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">mesh.triangles = triangles;</div></pre></td></tr></table></figure>
<p>如果一下子理解不了上面的算法，你可以先看看下面这种演示版:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">List&lt;Vector3&gt; grids = <span class="keyword">new</span> List&lt;Vector3&gt; ();</div><div class="line">List&lt;<span class="keyword">int</span>&gt; triangles = <span class="keyword">new</span> List&lt;<span class="keyword">int</span>&gt; ();</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt;= ySize; y++) &#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= xSize; x++) &#123;</div><div class="line">    grids.Add (<span class="keyword">new</span> Vector3 (x, y, <span class="number">0</span>));</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">mesh = <span class="keyword">new</span> Mesh ();</div><div class="line">mesh.vertices = grids.ToArray ();</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; ySize; y++) &#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; xSize; x++) &#123;</div><div class="line">    <span class="keyword">int</span> [] tri = <span class="keyword">new</span> <span class="keyword">int</span> [<span class="number">6</span>];</div><div class="line"></div><div class="line">    tri [<span class="number">0</span>] = grids.IndexOf (<span class="keyword">new</span> Vector3 (x, y));</div><div class="line">    tri [<span class="number">1</span>] = tri [<span class="number">4</span>] = grids.IndexOf (<span class="keyword">new</span> Vector3 (x, y + <span class="number">1</span>));</div><div class="line">    tri [<span class="number">2</span>] = tri [<span class="number">3</span>] = grids.IndexOf (<span class="keyword">new</span> Vector3 (x + <span class="number">1</span>, y));</div><div class="line">    tri [<span class="number">5</span>] = grids.IndexOf (<span class="keyword">new</span> Vector3 (x + <span class="number">1</span>, y + <span class="number">1</span>));</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tri.Length; i++) &#123;</div><div class="line">      triangles.Add (tri [i]);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">mesh.triangles = triangles.ToArray ();</div><div class="line">mesh.RecalculateNormals ();<span class="comment">//计算法线</span></div><div class="line"></div><div class="line">Gizmos.DrawMesh (mesh, Vector3.zero, Quaternion.identity);</div></pre></td></tr></table></figure>
<h2 id="小贴士-如何显示网格？"><a href="#小贴士-如何显示网格？" class="headerlink" title="小贴士: 如何显示网格？"></a>小贴士: 如何显示网格？</h2><p>在Scene窗口Tab栏最左侧下拉列表中选择 Shaded Wireframe 即可。</p>
<h1 id="Generating-Additonal-Vertex-Data-生成额外顶点数据"><a href="#Generating-Additonal-Vertex-Data-生成额外顶点数据" class="headerlink" title="Generating Additonal Vertex Data 生成额外顶点数据"></a>Generating Additonal Vertex Data 生成额外顶点数据</h1><p>我们的网格的光照很奇怪.这是因为没有给 Mesh 任何法线信息.默认法线方向为(0,0,1),这与我们需要的相反.</p>
<p>关于法线的物理性质我就不说了,相信各位中学物理都学过,入射角|法线|出射角 </p>
<p>我们需要填充另一个法线矢量数组,也可以自动生成.调用如下方法.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mesh.RecalculateNormals();</div></pre></td></tr></table></figure></p>
<p>生成UV信息.在生成网格的算法中插入uv计算代码.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vertices = <span class="keyword">new</span> Vector3 [(xSize + <span class="number">1</span>) * (ySize + <span class="number">1</span>)];</div><div class="line">Vector2 [] uv = <span class="keyword">new</span> Vector2 [vertices.Length];</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, y = <span class="number">0</span>; y &lt;= ySize; y++) &#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= xSize; x++, i++) &#123;</div><div class="line">    vertices [i] = <span class="keyword">new</span> Vector3 (x, y);</div><div class="line">    uv [i] = <span class="keyword">new</span> Vector2 ((<span class="keyword">float</span>)x / xSize, (<span class="keyword">float</span>)y / ySize);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">mesh.vertices = vertices;</div><div class="line">mesh.uv = uv;</div></pre></td></tr></table></figure></p>
<p>生成切线信息,添加每个顶点的切线信息.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">vertices = <span class="keyword">new</span> Vector3 [(xSize + <span class="number">1</span>) * (ySize + <span class="number">1</span>)];</div><div class="line">Vector2 [] uv = <span class="keyword">new</span> Vector2 [vertices.Length];</div><div class="line">Vector4 [] tangents = <span class="keyword">new</span> Vector4 [vertices.Length];</div><div class="line">Vector4 tangent = <span class="keyword">new</span> Vector4 (<span class="number">1</span>f, <span class="number">0</span>f, <span class="number">0</span>f, <span class="number">-1</span>f);</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, y = <span class="number">0</span>; y &lt;= ySize; y++) &#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= xSize; x++, i++) &#123;</div><div class="line">    vertices [i] = <span class="keyword">new</span> Vector3 (x, y);</div><div class="line">    uv [i] = <span class="keyword">new</span> Vector2 ((<span class="keyword">float</span>)x / xSize, (<span class="keyword">float</span>)y / ySize);</div><div class="line">    tangents [i] = tangent;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">mesh.vertices = vertices;</div><div class="line">mesh.uv = uv;</div><div class="line">mesh.tangents = tangents;</div></pre></td></tr></table></figure></p>
<h2 id="小贴士-法线是如何工作的"><a href="#小贴士-法线是如何工作的" class="headerlink" title="小贴士:法线是如何工作的"></a>小贴士:法线是如何工作的</h2><p>法线贴图是在切线空间中定义的.这是一个围绕物体表面流动的三维空间.这种方法允许我们在不同的位置和方向上应用相同的法线贴图。<br>在这个空间,表面法线代表向上,但是哪一个方向是正确的？这是由切线定义的。理想情况下，这两个向量之间的夹角为90°。它们的交叉积产生了定义三维空间所需的第三个方向.事实上,角度往往不是90°,但结果仍然很好.<br>所以切线是一个3D向量，但是Unity实际上使用了四维向量。第四部分是不是−1就是1，它是用来控制第三切线空间的维数–向前或向后的方向。这有助于法线贴图的镜像,这通常被用在像双边对称的事物的3D模型中.unity着色器计算的时候需要我们使用-1。</p>
<p>Normal maps are defined in tangent space. This is a 3D space that flows around the surface of an object. This approach allows us to apply the same normal map in different places and orientations.</p>
<p>The surface normal represents upward in this space, but which way is right? That’s defined by the tangent. Ideally, the angle between these two vectors is 90°. The cross product of them yields the third direction needed to define 3D space. In reality the angle is often not 90° but the results are still good enough.</p>
<p>So a tangent is a 3D vector, but Unity actually uses a 4D vector. Its fourth component is always either −1 or 1, which is used to control the direction of the third tangent space dimension – either forward or backward. This facilitates mirroring of normal maps, which is often used in 3D models of things with bilateral symmetry, like people. The way Unity’s shaders perform this calculation requires us to use −1.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;此主题分为四个部分讲述Mesh相关技术.本章主题如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a grid of points. 创建由点构成的网格. &lt;/li&gt;
&lt;li&gt;Use a coroutine to analyze their placement. 使用协程分析它们的位置信息.&lt;/li&gt;
&lt;li&gt;Define a surface with triangles. 使用三角形来定义表面. &lt;/li&gt;
&lt;li&gt;Automatically generate normals. 自动生成法线. &lt;/li&gt;
&lt;li&gt;Add texture coordinates and tangents. 添加贴图坐标与切线. &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此为本人阅读笔记不作为转载处理,详细还请参看原文. &lt;a href=&quot;http://catlikecoding.com/unity/tutorials/&quot;&gt;原文地址&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="翻译" scheme="http://vrast.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="UNITY3D" scheme="http://vrast.cn/tags/UNITY3D/"/>
    
  </entry>
  
  <entry>
    <title>SmartDataViewer Project Document</title>
    <link href="http://vrast.cn/posts/b5b9f139/"/>
    <id>http://vrast.cn/posts/b5b9f139/</id>
    <published>2017-06-21T06:34:17.000Z</published>
    <updated>2017-10-13T03:01:35.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>本文详细记录 SmartDataViewer 项目接口细节 并提供说明</p>
</blockquote>
<a id="more"></a>
<h1 id="为什么要使用-SmartDataViewer-？"><a href="#为什么要使用-SmartDataViewer-？" class="headerlink" title="为什么要使用 SmartDataViewer ？"></a>为什么要使用 SmartDataViewer ？</h1><p>SmartDataViewer 节约程序大量编辑器开发时间，在定义完成基础类型的时候，即可同步生成可视化编辑器。</p>
<h1 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h1><ol>
<li>秒速生成编辑器</li>
<li>支持外联多个类</li>
<li>支持针对特定字段进行排序与查询</li>
<li>支持数据导出导入(内建UNITY3D Json支持)</li>
<li>支持开放式编辑器事件,几乎所有的事件与组件渲染 用户可自定义</li>
<li>通过标签定制编辑器字段显示方式,包括宽度，显示别名，显示排序，导出导入位置等</li>
</ol>
<h1 id="正确的打开姿势-Tutorial"><a href="#正确的打开姿势-Tutorial" class="headerlink" title="正确的打开姿势 / Tutorial"></a>正确的打开姿势 / Tutorial</h1><h2 id="1-创建容器-Create-Container"><a href="#1-创建容器-Create-Container" class="headerlink" title="1.创建容器 / Create Container"></a>1.创建容器 / Create Container</h2><p>Type 1<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[Serializable]</div><div class="line">public class DemoConfig : ConfigBase&lt;Demo&gt; &#123; &#125;</div><div class="line"></div><div class="line">[Serializable]</div><div class="line">public class Demo : IModel</div><div class="line">&#123;</div><div class="line">	public Demo()</div><div class="line">	&#123;</div><div class="line">		strList = new List&lt;string&gt;();</div><div class="line">		list = new List&lt;int&gt;();</div><div class="line">		supports = new List&lt;int&gt;();</div><div class="line">		description = string.Empty;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public List&lt;string&gt; strList;</div><div class="line"></div><div class="line">	public List&lt;int&gt; list;</div><div class="line"></div><div class="line">	[ConfigEditorField(outLinkSubClass: "Supports")]</div><div class="line">	public List&lt;int&gt; supports;</div><div class="line"></div><div class="line">	public string description;</div><div class="line"></div><div class="line">	[ConfigEditorField(outLinkSubClass: "Supports")]</div><div class="line">	public int support;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Type 2<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">[Serializable]</div><div class="line">public class SupportsConfig : ConfigBase&lt;Supports&gt; &#123; &#125;</div><div class="line"></div><div class="line">[Serializable]</div><div class="line">public class Supports : IModel</div><div class="line">&#123;</div><div class="line">	public Supports()</div><div class="line">	&#123;</div><div class="line">		boolList = new List&lt;bool&gt;();</div><div class="line">		description = string.Empty;</div><div class="line">		colorList = new List&lt;Color&gt;();</div><div class="line">		curveList = new List&lt;AnimationCurve&gt;();</div><div class="line">		curve = new AnimationCurve();</div><div class="line">		bounds = new Bounds();</div><div class="line">		boundsList = new List&lt;Bounds&gt;();</div><div class="line">	&#125;</div><div class="line">	public Vector2 testPoint;</div><div class="line"></div><div class="line">	public List&lt;bool&gt; boolList;</div><div class="line"></div><div class="line">	public int testID;</div><div class="line"></div><div class="line">	public Bounds bounds;</div><div class="line"></div><div class="line">	public Color PointColor;</div><div class="line"></div><div class="line">	public AnimationCurve curve;</div><div class="line"></div><div class="line">	public List&lt;Color&gt; colorList;</div><div class="line"></div><div class="line">	public List&lt;AnimationCurve&gt; curveList;</div><div class="line"></div><div class="line">	public List&lt;Bounds&gt; boundsList;</div><div class="line"></div><div class="line">	public string description;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="2-添加标签-Add-Attribute"><a href="#2-添加标签-Add-Attribute" class="headerlink" title="2.添加标签 / Add Attribute"></a>2.添加标签 / Add Attribute</h2><h3 id="ConfigEditorAttribute"><a href="#ConfigEditorAttribute" class="headerlink" title="ConfigEditorAttribute"></a>ConfigEditorAttribute</h3><p>容器标签 / Container Attribute<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> Initializes a new instance of the <span class="doctag">&lt;see cref="T:SmartDataViewer.ConfigEditorAttribute"/&gt;</span> class.</span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="editor_title"&gt;</span>当前编辑器显示的名词<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="load_path"&gt;</span>当前编辑器数据文件的位置<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="output_path"&gt;</span>编辑文件导出路径<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="disableSearch"&gt;</span>是否禁用搜索栏<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="disableSave"&gt;</span>是否禁用保存按钮<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="disableCreate"&gt;</span>是否禁用添加按钮<span class="doctag">&lt;/param&gt;</span></span></div></pre></td></tr></table></figure></p>
<h3 id="ConfigEditorFieldAttribute"><a href="#ConfigEditorFieldAttribute" class="headerlink" title="ConfigEditorFieldAttribute"></a>ConfigEditorFieldAttribute</h3><p>字段标签 / Fields Attribute<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> Initializes a new instance of the <span class="doctag">&lt;see cref="T:SmartDataViewer.ConfigEditorFieldAttribute"/&gt;</span> class.</span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="order"&gt;</span>编辑器字段显示顺序<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="can_editor"&gt;</span>If set to <span class="doctag">&lt;c&gt;</span>true<span class="doctag">&lt;/c&gt;</span> can editor.<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="display"&gt;</span>编辑器中显示别名 不填为字段名<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="width"&gt;</span>编辑器中显示的字段宽度<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="outLinkEditor"&gt;</span>外联到新的编辑器<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="outLinkSubClass"&gt;</span>外联到新的子类型,如果遵循编辑器默认命名规则 只需要填写此项即可<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="outLinkClass"&gt;</span>外联到新的类型<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="visibility"&gt;</span>是否在编辑器中隐藏此字段<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="outLinkDisplay"&gt;</span>将显示外联数据的别名 默认显示外联数据的NickName如果没有则显示ID<span class="doctag">&lt;/param&gt;</span></span></div><div class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="outLinkFilePath"&gt;</span>外联数据的文件位置<span class="doctag">&lt;/param&gt;</span></span></div></pre></td></tr></table></figure></p>
<h2 id="3-生成代码-Click-Build-Button"><a href="#3-生成代码-Click-Build-Button" class="headerlink" title="3.生成代码 / Click Build Button"></a>3.生成代码 / Click Build Button</h2><p>点击build按钮 则会在指定路径生成数据编辑器<br><img src="/uploads/A6153579-9537-404D-9007-CE9B85F69BBF.png" alt="通过SmartDataViewer生成的编辑器"></p>
<h2 id="完成-Complete"><a href="#完成-Complete" class="headerlink" title="完成 / Complete"></a>完成 / Complete</h2><p><img src="/uploads/F1CC3692-35AB-4E74-B030-5E8006171256.png" alt="通过SmartDataViewer生成的编辑器"></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;本文详细记录 SmartDataViewer 项目接口细节 并提供说明&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Document" scheme="http://vrast.cn/categories/Document/"/>
    
    
      <category term="SmartDataViewer" scheme="http://vrast.cn/tags/SmartDataViewer/"/>
    
  </entry>
  
  <entry>
    <title>Unity Editor GUI Style</title>
    <link href="http://vrast.cn/posts/5b0bf452/"/>
    <id>http://vrast.cn/posts/5b0bf452/</id>
    <published>2017-04-27T08:54:27.000Z</published>
    <updated>2017-04-27T09:00:12.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>这几个Scrollview的属性藏的比较深 这里记录下。<br><a id="more"></a></p>
</blockquote>
<p>box<br>button<br>toggle<br>label<br>textField<br>textArea<br>window<br>horizontalSlider<br>horizontalSliderThumb<br>verticalSlider<br>verticalSliderThumb<br>horizontalScrollbar<br>horizontalScrollbarThumb<br>horizontalScrollbarLeftButton<br>horizontalScrollbarRightButton<br>verticalScrollbar<br>verticalScrollbarThumb<br>verticalScrollbarUpButton<br>verticalScrollbarDownButton<br>scrollView</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;这几个Scrollview的属性藏的比较深 这里记录下。&lt;br&gt;
    
    </summary>
    
      <category term="Editor" scheme="http://vrast.cn/categories/Editor/"/>
    
    
      <category term="ScrollView" scheme="http://vrast.cn/tags/ScrollView/"/>
    
  </entry>
  
</feed>
