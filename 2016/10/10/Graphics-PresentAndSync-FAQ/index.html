<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="In me the tiger sniffs the rose"><title>Graphics.PresentAndSync FAQ | Lazybones Kill PLAN</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Graphics.PresentAndSync FAQ</h1><a id="logo" href="/.">Lazybones Kill PLAN</a><p class="description">In me the tiger sniffs the rose</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Graphics.PresentAndSync FAQ</h1><div class="post-meta">Oct 10, 2016<span> | </span><span class="category"><a href="/categories/Unity3d/">Unity3d</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/10/10/Graphics-PresentAndSync-FAQ/" href="/2016/10/10/Graphics-PresentAndSync-FAQ/#comments" class="ds-thread-count"></a><div class="post-content"><p><img src="/uploads/EBA9A054-30D8-4A8F-AC61-82B2BE9112DB.jpg" alt=""></p>
<blockquote>
<p>PresentAndSync导致程序卡顿 本篇从多个角度介绍了针对PresentAndSync的措施</p>
</blockquote>
 <a id="more"></a>
<h1 id="关于VSync在iOS平台上的表现"><a href="#关于VSync在iOS平台上的表现" class="headerlink" title="关于VSync在iOS平台上的表现"></a>关于VSync在iOS平台上的表现</h1><p>1.iOS devices are always vsynced and that can’t be changed. vsync is allways ON, for iOS and cannot be turned off<br>2.By default the framerate is capped at 30;<br>3.you can use Application.targetFrameRate to change it to 60.</p>
<h1 id="Graphics-PresentAndSync-是什么？"><a href="#Graphics-PresentAndSync-是什么？" class="headerlink" title="Graphics.PresentAndSync 是什么？"></a>Graphics.PresentAndSync 是什么？</h1><p>1.主线程进行Present时的等待时间和等待垂直同步的时间<br>2.其真实的意思应该是为了在渲染子线程（Rendering Thread）中进行Present，当前主线程（MainThread）需要等待的时间。<br>3.引擎会在主线程中进行Present(当前绝大多数的移动游戏均在使用该中操作)，当然，Present操作同样需要等待GPU完成上一次的渲染。如果GPU渲染开销很大，则CPU的Present操作将一直处于等待操作，其等待时间，即为当前帧的Graphics.PresentAndSync时间</p>
<h1 id="为什么会导致Graphics-PresentAndSync过高💥"><a href="#为什么会导致Graphics-PresentAndSync过高💥" class="headerlink" title="为什么会导致Graphics.PresentAndSync过高💥"></a>为什么会导致Graphics.PresentAndSync过高💥</h1><p>CPU端开销很高，使得Present执行时错过了VSync操作，这样，Present将不得不等待下一次VSync的到来，从而造成了Gfx.WaitForPresent 和 Graphics.PresentAndSync的CPU开销较高。这种情况在CPU端加载过量资源时特别容易发生，比如WWW加载较大的AssetBundle、Resource.Load加载大量的Texture等等。</p>
<p>造成这两个参数的CPU占用较高的原因主要有以下三种原因：<br>1.CPU开销非常低，所以CPU在等待GPU完成渲染工作或等待VSync的到来；<br>2.CPU开销很高，使Present错过了当前帧的VSync，即不得不等待下一次VSync的到来<br>3.GPU开销很高，CPU的Present需要等待GPU上一帧渲染工作的完成。</p>
<h1 id="一些论坛的FAQ有一定参考意义"><a href="#一些论坛的FAQ有一定参考意义" class="headerlink" title="一些论坛的FAQ有一定参考意义"></a>一些论坛的FAQ有一定参考意义</h1><h2 id="这个是硬件设备强制开启的，Unity是无法对其进行关闭的"><a href="#这个是硬件设备强制开启的，Unity是无法对其进行关闭的" class="headerlink" title="这个是硬件设备强制开启的，Unity是无法对其进行关闭的"></a>这个是硬件设备强制开启的，Unity是无法对其进行关闭的</h2><p>出现这种情况的问题可能有以下几种：<br>1、渲染成本过高，可能使用了iPad2当前OS无法很好支持的渲染功能。<br>2、是否在其他线程中有大量加载资源的情况出现，该情况同样会导致该选项过高（原因是垂直同步）</p>
<h2 id="通过对帧数的限制来防止垂直同步的等待"><a href="#通过对帧数的限制来防止垂直同步的等待" class="headerlink" title="通过对帧数的限制来防止垂直同步的等待"></a>通过对帧数的限制来防止垂直同步的等待</h2><p>发现在unity上对帧数限制不管用，后来在xcode上面的接收unity帧数的函数里强行对帧行进了限制</p>
<h1 id="解决卡顿的一些建议"><a href="#解决卡顿的一些建议" class="headerlink" title="解决卡顿的一些建议"></a>解决卡顿的一些建议</h1><p>1.强制关闭垂直同步方案,强制设置帧率至60(仍然需要做CPU优化)<br>2.均摊计算到不同帧，降低CPU计算 使用Profiler查找开销源<br>3.优化Shader GPU 垂直同步问题是双向的，既要优化CPU也要优化GPU运算</p>
<h1 id="一些类似的问题"><a href="#一些类似的问题" class="headerlink" title="一些类似的问题"></a>一些类似的问题</h1><h2 id="场景1-IPhone4-Unity3D-Version4-X-遇到"><a href="#场景1-IPhone4-Unity3D-Version4-X-遇到" class="headerlink" title="场景1 IPhone4 Unity3D Version4.X 遇到"></a>场景1 IPhone4 Unity3D Version4.X 遇到</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">As it turns out, we hade to modify our shader code. The same shaders that had very little performance impact in 3.3 had massive performance impact on iOS in 3.4. So if you are stuck, <span class="keyword">check</span> there. Also, <span class="keyword">in</span> AppController.mm, <span class="keyword">change</span> this:</div><div class="line"></div><div class="line"><span class="keyword">define</span> USE_OPENGLES20_IF_AVAILABLE <span class="number">1</span></div><div class="line"><span class="keyword">To</span> this:</div><div class="line"><span class="keyword">define</span> USE_OPENGLES20_IF_AVAILABLE <span class="number">0</span></div><div class="line">Which we <span class="keyword">found</span> also gave us a significant FPS increase (nearly doubled our framerate <span class="keyword">on</span> iOS).</div><div class="line"></div><div class="line"><span class="keyword">url</span> : <span class="keyword">http</span>://answers.unity3d.com/questions/<span class="number">152966</span>/massive-<span class="keyword">performance</span>-decrease-<span class="keyword">in</span><span class="number">-34</span>-devicepresent-t.html</div></pre></td></tr></table></figure>
<h2 id="场景2-Unity3D-5-X"><a href="#场景2-Unity3D-5-X" class="headerlink" title="场景2 Unity3D 5.X"></a>场景2 Unity3D 5.X</h2><figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">In</span> <span class="number">5.4</span> uncheking the <span class="string">"Auto Graphics API "</span> ( <span class="built_in">in</span> <span class="built_in">player</span> settings) <span class="built_in">and</span> deleting GLES3 Gave me back a few <span class="built_in">FPS</span></div></pre></td></tr></table></figure>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://answers.unity3d.com/questions/602628/why-does-my-game-require-so-much-rendering-power.html" target="_blank" rel="external">http://answers.unity3d.com/questions/602628/why-does-my-game-require-so-much-rendering-power.html</a><br><a href="http://answers.unity3d.com/questions/152966/massive-performance-decrease-in-34-devicepresent-t.html" target="_blank" rel="external">http://answers.unity3d.com/questions/152966/massive-performance-decrease-in-34-devicepresent-t.html</a><br><a href="https://forum.unity3d.com/threads/graphics-presentandsync-problem.318705/" target="_blank" rel="external">https://forum.unity3d.com/threads/graphics-presentandsync-problem.318705/</a><br><a href="https://docs.unity3d.com/Manual/class-QualitySettings.html" target="_blank" rel="external">https://docs.unity3d.com/Manual/class-QualitySettings.html</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://vrast.cn/2016/10/10/Graphics-PresentAndSync-FAQ/" data-id="civix8ixt0007v010a0zs1xu3" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Optimize/">Optimize</a></div><div class="post-nav"><a href="/2016/10/12/优化XCode磁盘空间占用/" class="pre">优化XCode磁盘空间占用</a><a href="/2016/09/27/关于现在/" class="next">关于现在</a></div><div data-thread-key="2016/10/10/Graphics-PresentAndSync-FAQ/" data-title="Graphics.PresentAndSync FAQ" data-url="http://vrast.cn/2016/10/10/Graphics-PresentAndSync-FAQ/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/10/10/Graphics-PresentAndSync-FAQ/" data-title="Graphics.PresentAndSync FAQ" data-url="http://vrast.cn/2016/10/10/Graphics-PresentAndSync-FAQ/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://vrast.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AppStore/">AppStore</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Framework/">Framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Host/">Host</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/INTENSE项目源码分析/">INTENSE项目源码分析</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SDK/">SDK</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Site/">Site</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/StrangeIOC教程目录/">StrangeIOC教程目录</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Terminal/">Terminal</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/UNITY3D-iOS/">UNITY3D&iOS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity3D/">Unity3D</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity3d/">Unity3d</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/图形学/">图形学</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习手札/">学习手札</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/阅读笔记/">阅读笔记</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/StrangeIOC/" style="font-size: 15px;">StrangeIOC</a> <a href="/tags/terminal/" style="font-size: 15px;">terminal</a> <a href="/tags/Optimize/" style="font-size: 15px;">Optimize</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/shader-图形学/" style="font-size: 15px;">shader 图形学</a> <a href="/tags/INTENSE总纲/" style="font-size: 15px;">INTENSE总纲</a> <a href="/tags/rendertexure/" style="font-size: 15px;">rendertexure</a> <a href="/tags/INTENSE文档/" style="font-size: 15px;">INTENSE文档</a> <a href="/tags/markdown-语法/" style="font-size: 15px;">markdown 语法</a> <a href="/tags/Interaction/" style="font-size: 15px;">Interaction</a> <a href="/tags/sharderforge/" style="font-size: 15px;">sharderforge</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/YouMi/" style="font-size: 15px;">YouMi</a> <a href="/tags/IAP/" style="font-size: 15px;">IAP</a> <a href="/tags/Graphic/" style="font-size: 15px;">Graphic</a> <a href="/tags/protobuf/" style="font-size: 15px;">protobuf</a> <a href="/tags/ZSH/" style="font-size: 15px;">ZSH</a> <a href="/tags/XCode/" style="font-size: 15px;">XCode</a> <a href="/tags/Terminal/" style="font-size: 15px;">Terminal</a> <a href="/tags/VSCode/" style="font-size: 15px;">VSCode</a> <a href="/tags/shader/" style="font-size: 15px;">shader</a> <a href="/tags/None/" style="font-size: 15px;">None</a> <a href="/tags/Unity3D编辑器/" style="font-size: 15px;">Unity3D编辑器</a> <a href="/tags/Git技巧/" style="font-size: 15px;">Git技巧</a> <a href="/tags/PerGUI/" style="font-size: 15px;">PerGUI</a> <a href="/tags/VPN/" style="font-size: 15px;">VPN</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/11/14/YouMiSDK-FAQ/">YouMiSDK FAQ</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/14/Coding-net-Pages部署/">Coding.net Pages部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/31/AppStore-Create-New-Application-FAQ/"> AppStore Create New Application FAQ</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/25/优化hexo访问速度/">优化hexo访问速度</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/25/UNITY3D-IOS-Interaction/">UNITY3D & IOS PAY</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/24/Documentation-Intense-Tps-pdf/">Documentation Intense Tps.pdf</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/14/GaussianBlur-Shader/">GaussianBlur Shader</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/14/让Git密匙同时存在多个/">让Git密匙同时存在多个</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/12/INTENSE-TPS-项目分析概述/">INTENSE TPS 项目分析概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/12/优化XCode磁盘空间占用/">优化XCode磁盘空间占用</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/KeyleXiao" title="GitHub keyle" target="_blank">GitHub keyle</a><ul></ul><a href="https://twitter.com/keyle_xiao" title="Twitter keyle" target="_blank">Twitter keyle</a><ul></ul><a href="http://weibo.com/xiaoxiaoxiaonian" title="Weibo keyle" target="_blank">Weibo keyle</a><ul></ul><a href="http://git.oschina.net/keyle" title="OSChina keyle" target="_blank">OSChina keyle</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Lazybones Kill PLAN.</a> 本站采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">知识共享署名-非商业性使用-禁止演绎 3.0 未本地化版本许可协议</a>进行许可</div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'xiaonian'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f11c449fa2982da90b9b0eac29158c20";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>